<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../favicon.png">
    <link rel="apple-touch-icon" href="../favicon.png">
    <title>ì›ë”ì—ë„ˆì§€ ìˆ˜ì†Œì¶©ì „ì†Œ ê³ ê° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
        .leaflet-popup-content { font-size: 13px; line-height: 1.4; }
        .marker-icon { display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; font-size: 12px; }

        /* Enhanced Card Styles */
        .stat-card {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px -8px rgba(0,0,0,0.15);
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        /* Custom Input Styles */
        .input-number {
            -moz-appearance: textfield;
        }
        .input-number::-webkit-outer-spin-button,
        .input-number::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Progress Animation */
        .progress-bar {
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Slider Thumb Enhancement - Enhanced Visibility */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 12px;
            background: linear-gradient(to right, #3b82f6, #60a5fa, #93c5fd);
            border-radius: 6px;
            border: 2px solid #1e40af;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.1);
            outline: none;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-runnable-track {
            height: 12px;
            background: transparent;
            border-radius: 6px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(59,130,246,0.5), 0 0 0 2px #1e40af;
            margin-top: -6px;
            transition: transform 0.15s ease;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(59,130,246,0.6), 0 0 0 3px #1e40af;
        }
        input[type="range"]::-moz-range-track {
            height: 12px;
            background: linear-gradient(to right, #3b82f6, #60a5fa, #93c5fd);
            border-radius: 6px;
            border: 2px solid #1e40af;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(59,130,246,0.5), 0 0 0 2px #1e40af;
        }

        /* Slider container with tick marks */
        .slider-container {
            position: relative;
            padding-bottom: 20px;
        }
        .slider-ticks {
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            margin-top: 4px;
        }
        .slider-ticks span {
            font-size: 10px;
            color: #64748b;
            position: relative;
        }
        .slider-ticks span::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 6px;
            background: #94a3b8;
        }

        /* Gradient Backgrounds */
        .gradient-blue { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .gradient-green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .gradient-purple { background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); }
        .gradient-orange { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
        .gradient-cyan { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
        .gradient-rose { background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); }

        /* Tab Styles */
        .tab-btn { transition: all 0.2s ease; }
        .tab-btn.active { border-bottom: 2px solid #3b82f6; color: #3b82f6; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Icon Marker Styles */
        .marker-station { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .marker-customer { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .marker-potential { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
        .marker-depot { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .marker-h2depot { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }

        /* Category Badge Styles */
        .badge-customer { background: #dbeafe; color: #1e40af; }
        .badge-potential { background: #ffedd5; color: #c2410c; }
        .badge-depot { background: #ede9fe; color: #6b21a8; }
        .badge-h2 { background: #cffafe; color: #0e7490; }

        /* Data List Styles */
        .data-list-item { transition: background 0.15s ease; }
        .data-list-item:hover { background: #f8fafc; }

        /* Help Modal Styles */
        .help-tab {
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .help-tab:hover {
            color: #3b82f6;
            background: #f1f5f9;
        }
        .help-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: white;
        }
        .help-content h3 {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        .help-content table {
            width: 100%;
            font-size: 13px;
            margin: 12px 0;
        }
        .help-content table th {
            background: #f1f5f9;
            padding: 8px 12px;
            text-align: left;
            font-weight: 600;
        }
        .help-content table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        .help-content .tip {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 16px 0;
            font-size: 13px;
            color: #1e40af;
        }
        .help-content ul {
            margin: 8px 0;
            padding-left: 20px;
        }
        .help-content li {
            margin: 4px 0;
            font-size: 13px;
        }

        /* Station Usage Tooltip */
        .station-tooltip {
            position: fixed;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            z-index: 100001;
            min-width: 320px;
            max-width: 420px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s ease;
        }
        .station-tooltip.visible {
            opacity: 1;
        }
        .station-tooltip h4 {
            font-weight: 600;
            font-size: 14px;
            color: #1e3a5f;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        .station-tooltip .pogok-distance {
            font-size: 12px;
            color: #059669;
            background: #ecfdf5;
            padding: 6px 10px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        .station-tooltip .pogok-distance strong {
            font-weight: 600;
            color: #047857;
        }
        .station-tooltip table {
            font-size: 12px;
            width: 100%;
            border-collapse: collapse;
        }
        .station-tooltip th {
            text-align: left;
            color: #6b7280;
            font-weight: 500;
            padding: 4px 8px 4px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .station-tooltip td {
            padding: 6px 8px 6px 0;
            border-bottom: 1px solid #f9fafb;
        }
        .station-tooltip tr:last-child td {
            border-bottom: none;
        }
        .station-tooltip .text-right {
            text-align: right;
        }
        .station-tooltip .kg-value {
            color: #059669;
            font-weight: 500;
        }
        .station-tooltip .km-value {
            color: #3b82f6;
        }
        .station-tooltip .no-data {
            color: #9ca3af;
            font-style: italic;
            padding: 8px 0;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header - Sticky for easy month switching -->
    <header class="bg-gradient-to-r from-slate-900 via-blue-900 to-slate-900 text-white shadow-2xl sticky top-0 z-[100000]">
        <div class="container mx-auto px-6 py-5">
            <div class="flex items-center justify-between">
                <!-- ì¢Œì¸¡: ë¡œê³  + íƒ€ì´í‹€ + ì´ìš©ë°©ë²• ë²„íŠ¼ -->
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                        <span class="text-2xl">âš¡</span>
                    </div>
                    <div>
                        <div class="flex items-center gap-3">
                            <h1 class="text-2xl font-bold tracking-tight">
                                ì›ë”ì—ë„ˆì§€ ìˆ˜ì†Œì¶©ì „ì†Œ <span class="text-blue-300">ìˆ˜ìš” ë¶„ì„</span> ëŒ€ì‹œë³´ë“œ
                            </h1>
                            <button id="helpBtn" onclick="openHelpModal()" class="flex items-center gap-1.5 px-3 py-1.5 bg-yellow-400 hover:bg-yellow-300 text-slate-900 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span class="text-sm font-bold">ì´ìš©ë°©ë²•</span>
                            </button>
                        </div>
                        <p class="text-blue-200/80 text-sm mt-0.5">
                            ìš©ì¸ í¬ê³¡ ì‚¼ê³„ë¦¬ ì‹ ê·œ ì¶©ì „ì†Œ (2026.10 ì˜¤í”ˆ ì˜ˆì •) Â· ê±°ë˜ì²˜ Â· ì ì¬ìˆ˜ìš” í†µí•© ë¶„ì„
                        </p>
                    </div>
                </div>
                <!-- ìš°ì¸¡: ì›” ì„ íƒ íƒ­ -->
                <div class="flex items-center gap-2">
                    <div class="flex bg-blue-800/50 rounded-lg p-1">
                        <button onclick="switchMonth('2024-10')" id="month-tab-2024-10" class="month-tab px-4 py-1.5 rounded-md text-sm font-medium transition-all text-blue-200 hover:bg-blue-700/50">
                            10ì›”
                        </button>
                        <button onclick="switchMonth('2024-11')" id="month-tab-2024-11" class="month-tab px-4 py-1.5 rounded-md text-sm font-medium transition-all bg-white text-blue-600">
                            11ì›”
                        </button>
                    </div>
                    <div class="text-right text-sm hidden md:block ml-2">
                        <div class="text-blue-200/60">ë°ì´í„° ê¸°ì¤€</div>
                        <div class="font-medium" id="currentMonthDisplay">2024ë…„ 11ì›”</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <!-- Summary Cards - Enhanced Design with Categories -->
        <div class="grid grid-cols-2 lg:grid-cols-6 gap-4 mb-6">
            <div class="stat-card gradient-blue rounded-xl shadow-lg p-4 text-white">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white/80 text-xs font-medium">ìˆ˜ì†Œë²„ìŠ¤ ëŒ€ìˆ˜</span>
                    <span class="text-xl">ğŸšŒ</span>
                </div>
                <div class="text-2xl font-bold tracking-tight" id="vehicleCountDisplay">81<span class="text-sm ml-1">ëŒ€</span></div>
                <div class="text-white/60 text-[10px] mt-1" id="customerCountLabel">ê±°ë˜ì²˜ 15ê°œ</div>
            </div>
            <div class="stat-card gradient-orange rounded-xl shadow-lg p-4 text-white">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white/80 text-xs font-medium">ì ì¬ê³ ê° (ì¿ íŒ¡)</span>
                    <span class="text-xl">ğŸ¯</span>
                </div>
                <div class="text-2xl font-bold tracking-tight" id="potentialCount">16<span class="text-sm ml-1">ê°œ</span></div>
                <div class="text-white/60 text-[10px] mt-1">ë„ë¡œê±°ë¦¬ 30km ì´ë‚´</div>
            </div>
            <div class="stat-card gradient-purple rounded-xl shadow-lg p-4 text-white">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white/80 text-xs font-medium">ì£¼ë³€ ë²„ìŠ¤ ì°¨ê³ ì§€</span>
                    <span class="text-xl">ğŸšŒ</span>
                </div>
                <div class="text-2xl font-bold tracking-tight" id="depotCount">5<span class="text-sm ml-1">ê°œ</span></div>
                <div class="text-white/60 text-[10px] mt-1">ì‹œë‚´/ê´‘ì—­ë²„ìŠ¤</div>
            </div>
            <div class="stat-card gradient-cyan rounded-xl shadow-lg p-4 text-white">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white/80 text-xs font-medium">ì£¼ë³€ ìš´ìˆ˜ì‚¬ ìˆ˜ì†Œë²„ìŠ¤</span>
                    <span class="text-xl">ğŸ’§</span>
                </div>
                <div class="text-2xl font-bold tracking-tight" id="h2BusCount">7<span class="text-sm ml-1">ëŒ€</span></div>
                <div class="text-white/60 text-[10px] mt-1">ì´ì²œì‹œë‚´ë²„ìŠ¤ 111ë²ˆ</div>
            </div>
            <div class="stat-card gradient-green rounded-xl shadow-lg p-4 text-white">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white/80 text-xs font-medium" id="chargeCardLabel">11ì›” ì›ë” ì „ì²´ ì¶©ì „ëŸ‰</span>
                    <span class="text-xl">â›½</span>
                </div>
                <div class="text-2xl font-bold tracking-tight" id="monthlyChargeDisplay">21,766<span class="text-sm ml-1">kg</span></div>
                <div class="text-white/60 text-[10px] mt-1" id="chargeChangeDisplay">ì „ì›” ëŒ€ë¹„ +4,565kg (+26.5%)</div>
            </div>
            <div class="stat-card gradient-rose rounded-xl shadow-lg p-4 text-white">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white/80 text-xs font-medium">MTOP ëª©í‘œ</span>
                    <span class="text-xl">ğŸ“Š</span>
                </div>
                <div class="text-2xl font-bold tracking-tight" id="mtopTargetDisplay">30,000<span class="text-sm ml-1">kg</span></div>
                <div class="text-white/60 text-[10px] mt-1">ì›”ê°„ ìµœì†Œ ê³„ì•½ëŸ‰</div>
            </div>
        </div>

        <!-- ì§€ë„ + ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ (ìƒë‹¨) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Map Section -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow h-full flex flex-col">
                    <div class="p-4 border-b">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-semibold">í¬ê³¡ì ì‚¬ì—…ë¶€ì§€ ì£¼ë³€ ì‹œê°í™”</h2>
                            <button onclick="resetMapView()" class="flex items-center gap-1 px-3 py-1.5 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-sm font-medium transition-colors">
                                <span>ğŸ¯</span>
                                <span>ì›ìœ„ì¹˜</span>
                            </button>
                        </div>
                        <div class="mt-3">
                            <div class="flex items-center gap-4 mb-1">
                                <span class="text-sm text-gray-600 font-medium">ì§ì„  ë°˜ê²½ ì„ íƒ:</span>
                                <span id="radiusValue" class="text-lg font-bold text-blue-600">20km</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" id="radiusSlider" min="5" max="50" value="20" step="5" class="w-full">
                                <div class="slider-ticks">
                                    <span>5</span><span>10</span><span>15</span><span>20</span><span>25</span><span>30</span><span>35</span><span>40</span><span>45</span><span>50km</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="map" class="flex-1 min-h-[400px] relative z-0"></div>
                    <div class="p-3 bg-gray-50 border-t">
                        <!-- Legend - Row 1: Categories with toggles -->
                        <div class="flex flex-wrap items-center gap-3 text-xs">
                            <span class="text-gray-600 font-medium">ë ˆì´ì–´:</span>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="stationToggle" checked class="mr-1 accent-green-500 w-3.5 h-3.5">
                                <span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-1"></span>
                                <span>ì¶©ì „ì†Œ</span>
                            </label>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="customerToggle" checked class="mr-1 accent-blue-500 w-3.5 h-3.5">
                                <span class="inline-block w-3 h-3 rounded bg-blue-500 mr-1"></span>
                                <span class="text-blue-600 font-medium">ê±°ë˜ì²˜</span>
                            </label>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="fcToggle" checked class="mr-1 accent-orange-500 w-3.5 h-3.5">
                                <span class="inline-block w-3 h-3 rotate-45 bg-orange-500 mr-1"></span>
                                <span class="text-orange-600 font-medium">ì ì¬ê³ ê°</span>
                            </label>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="depotToggle" checked class="mr-1 accent-purple-500 w-3.5 h-3.5">
                                <span class="inline-block w-3 h-3 rounded bg-purple-500 mr-1" style="clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);"></span>
                                <span class="text-purple-600 font-medium">ë²„ìŠ¤ì°¨ê³ ì§€</span>
                            </label>
                        </div>
                        <!-- Legend - Row 2: Distance legend -->
                        <div id="distanceLegend" class="mt-2 pt-2 border-t border-gray-200 flex flex-wrap gap-3 text-xs">
                            <span class="text-gray-500">ê±°ë¦¬:</span>
                            <span><span class="inline-block w-3 h-3 rounded bg-green-500 mr-1"></span> ~10km</span>
                            <span><span class="inline-block w-3 h-3 rounded bg-yellow-500 mr-1"></span> 10-30km</span>
                            <span><span class="inline-block w-3 h-3 rounded bg-orange-500 mr-1"></span> 30km+</span>
                            <span class="border-l pl-3 ml-1"><span class="inline-block w-3 h-3 rounded border-2 border-cyan-500 bg-cyan-100 mr-1"></span> ìˆ˜ì†Œë²„ìŠ¤ ìš´í–‰</span>
                            <span><span class="inline-block w-3 h-3 rounded border-2 border-red-500 bg-gray-100 mr-1"></span> 3êµëŒ€ ìš´ì˜</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulation Results (ë†’ì´ ë§ì¶¤) -->
            <div class="bg-white rounded-lg shadow p-4 h-full flex flex-col">
                <h2 class="text-lg font-semibold mb-4">ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼</h2>
                <div id="simulationResults" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
                <!-- ë°˜ê²½ ë‚´ ê±°ë˜ì²˜ ìƒì„¸ í…Œì´ë¸” -->
                <div id="customersInRangeSection" class="mt-4 pt-4 border-t border-gray-200 flex-1 flex flex-col">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">ë°˜ê²½ ë‚´ ê±°ë˜ì²˜ ìƒì„¸</h3>
                    <div class="overflow-y-auto flex-1 custom-scrollbar">
                        <table class="w-full text-xs">
                            <thead class="bg-slate-100 sticky top-0">
                                <tr>
                                    <th class="px-2 py-1.5 text-left font-semibold text-slate-600">ê±°ë˜ì²˜ëª…</th>
                                    <th class="px-2 py-1.5 text-right font-semibold text-cyan-600">ìˆ˜ì†Œë²„ìŠ¤</th>
                                    <th class="px-2 py-1.5 text-right font-semibold text-slate-600">ì¶©ì „ëŸ‰</th>
                                    <th class="px-2 py-1.5 text-right font-semibold text-slate-600">ë„ë¡œê±°ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="customersInRangeTable">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì¼ê°„ ëª©í‘œ ì„¤ì • + MTOP ì¶©ì¡±ë¥  (ì§€ë„ ì•„ë˜ ë‚˜ë€íˆ) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4">
            <!-- MTOP Daily Target Setting -->
            <div class="bg-white rounded-xl shadow-lg p-5 border border-gray-100">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-800">ì¼ê°„ ëª©í‘œ ì„¤ì •</h2>
                    <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">100kg ë‹¨ìœ„</span>
                </div>
                <div class="space-y-4">
                    <!-- Daily Target Input -->
                    <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-4 border border-orange-100">
                        <div class="flex items-center justify-between mb-2">
                            <label class="text-sm font-medium text-gray-700">ì¼ì¼ ëª©í‘œ ì¶©ì „ëŸ‰</label>
                            <div class="relative">
                                <input type="number" id="dailyTargetInput"
                                    value="1000" min="100" max="1500" step="100"
                                    class="input-number w-28 pl-3 pr-10 py-2 text-right border-2 border-orange-300 rounded-lg text-sm font-bold text-orange-700 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white">
                                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-xs text-orange-500 pointer-events-none font-medium">kg</span>
                            </div>
                        </div>
                        <div class="slider-container">
                            <input type="range" id="dailyTargetSlider"
                                min="100" max="1500" value="1000" step="100"
                                class="w-full cursor-pointer">
                            <div class="slider-ticks" style="padding: 0 8px;">
                                <span>100</span><span>300</span><span>500</span><span>700</span><span>900</span><span>1100</span><span>1300</span><span>1500</span>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Target (Calculated) -->
                    <div class="bg-gray-50 rounded-lg p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">ì›”ê°„ ëª©í‘œ (30ì¼ ê¸°ì¤€)</span>
                            <span id="monthlyTargetCalc" class="text-lg font-bold text-orange-600">30,000 kg</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MTOP Progress -->
            <div class="bg-white rounded-xl shadow-lg p-5 border border-gray-100">
                <h2 class="text-lg font-semibold mb-4 text-gray-800">MTOP ì¶©ì¡±ë¥ </h2>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between text-sm mb-2">
                            <span id="mtopLabel" class="text-gray-600">ì˜ˆìƒ ì¶©ì „ëŸ‰</span>
                            <span id="mtopPercent" class="font-bold text-blue-600">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-5 overflow-hidden">
                            <div id="mtopBar" class="progress-bar bg-gradient-to-r from-blue-500 to-blue-600 h-5 rounded-full flex items-center justify-end pr-2" style="width: 0%">
                                <span id="mtopBarText" class="text-xs font-medium text-white"></span>
                            </div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-2">
                            <span>0</span>
                            <span id="mtopTargetLabel">30,000 kg (MTOP)</span>
                        </div>
                    </div>
                    <!-- Status Indicator -->
                    <div id="mtopStatus" class="flex items-center gap-2 p-3 rounded-lg bg-blue-50 border border-blue-200">
                        <div class="w-3 h-3 rounded-full bg-blue-500 animate-pulse"></div>
                        <span class="text-sm text-blue-700">í˜„ì¬ ë°˜ê²½ ê¸°ì¤€ ì˜ˆìƒ ì¶©ì „ëŸ‰</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <!-- Company Chart with Detail Table - ì„¸ë¡œ ë°°ì¹˜ (íŒŒì´ ê·¸ë˜í”„ ì•„ë˜ì— í‘œ) -->
            <div class="bg-white rounded-lg shadow p-5">
                <h2 class="text-xl font-bold mb-5 text-gray-800" id="companyChartTitle">ë²•ì¸ë³„ ì¶©ì „ëŸ‰ (11ì›”)</h2>
                <!-- íŒŒì´ ì°¨íŠ¸ - í¬ê¸° í™•ëŒ€ -->
                <div class="flex justify-center mb-6">
                    <div class="w-72 h-72">
                        <canvas id="companyChart"></canvas>
                    </div>
                </div>
                <!-- ìƒì„¸ í…Œì´ë¸” - íŒŒì´ ê·¸ë˜í”„ ì•„ë˜ ë°°ì¹˜ -->
                <div class="overflow-x-auto border-t pt-4">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="px-3 py-2 text-left font-semibold text-slate-700">ë²•ì¸</th>
                                <th class="px-3 py-2 text-right font-semibold text-slate-700">ê±°ë˜ì²˜</th>
                                <th class="px-3 py-2 text-right font-semibold text-slate-700">ë²„ìŠ¤</th>
                                <th class="px-3 py-2 text-right font-semibold text-slate-700">ì¶©ì „ëŸ‰</th>
                                <th class="px-3 py-2 text-right font-semibold text-slate-700">íšŸìˆ˜</th>
                                <th class="px-3 py-2 text-right font-semibold text-slate-700">ì¼í‰ê· </th>
                                <th class="px-3 py-2 text-right font-semibold text-slate-700">ì£¼ê¸°</th>
                            </tr>
                        </thead>
                        <tbody id="companyDetailTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Customer Chart with N-selector -->
            <div class="bg-white rounded-lg shadow p-5">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">ê±°ë˜ì²˜ë³„ ì¶©ì „ëŸ‰</h2>
                    <select id="topNSelector" class="border rounded px-2 py-1 text-sm bg-white">
                        <option value="5">ìƒìœ„ 5ê°œ</option>
                        <option value="10" selected>ìƒìœ„ 10ê°œ</option>
                        <option value="15">ì „ì²´ (15ê°œ)</option>
                    </select>
                </div>
                <!-- ëª¨ë°”ì¼ì—ì„œ ì°¨íŠ¸ í‘œì‹œë¥¼ ìœ„í•œ min-height ì¶”ê°€ -->
                <div class="w-full" style="min-height: 200px;">
                    <canvas id="customerChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Tables with Tabs -->
        <div class="bg-white rounded-lg shadow mt-6">
            <!-- Tab Header -->
            <div class="border-b">
                <div class="flex">
                    <button class="tab-btn active px-6 py-3 text-sm text-gray-600 hover:text-blue-600" data-tab="customers">
                        ğŸ¢ í˜„ì¬ ê±°ë˜ì²˜(ìˆ˜ì†Œë²„ìŠ¤) <span class="ml-1 text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full" id="customerTabCount">15ê°œ (81ëŒ€)</span>
                    </button>
                    <button class="tab-btn px-6 py-3 text-sm text-gray-600 hover:text-orange-600" data-tab="potential">
                        ğŸ¯ ì ì¬ê³ ê° <span class="ml-1 text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full" id="potentialTabCount">28</span>
                    </button>
                    <button class="tab-btn px-6 py-3 text-sm text-gray-600 hover:text-purple-600" data-tab="depots">
                        ğŸšŒ ë²„ìŠ¤ ì°¨ê³ ì§€ <span class="ml-1 text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full" id="depotTabCount">5</span>
                    </button>
                    <button class="tab-btn px-6 py-3 text-sm text-gray-600 hover:text-green-600" data-tab="stations">
                        â›½ íƒ€ì‚¬ ì¶©ì „ì†Œ ì´ìš© í˜„í™© <span class="ml-1 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full" id="stationTabCount">14</span>
                    </button>
                </div>
            </div>

            <!-- Tab Content: Customers -->
            <div class="tab-content active" id="tab-customers">
                <div class="p-4 bg-blue-50 border-b">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-blue-800">í˜„ì¬ ê±°ë˜ì²˜ (ì›ë”ëª¨ë¹Œë¦¬í‹° ì†Œì†)</h3>
                            <p class="text-xs text-blue-600 mt-1" id="customerTableDescription">2025ë…„ 11ì›” ê¸°ì¤€ ìˆ˜ì†Œë²„ìŠ¤ ìš´í–‰ ê±°ë˜ì²˜ | ì¶©ì „ê¸ˆì•¡Â·1kgë‹¨ê°€ëŠ” <strong>ë¶€ê°€ì„¸ í¬í•¨</strong></p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-cyan-700" id="totalH2BusesDisplay">81<span class="text-sm">ëŒ€</span></div>
                            <div class="text-xs text-cyan-600">ìˆ˜ì†Œë²„ìŠ¤ í•©ê³„</div>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 sticky top-0" id="customerTableHeaders">
                            <tr>
                                <th class="px-2 py-2 text-center w-10">#</th>
                                <th class="px-3 py-2 text-left cursor-pointer hover:bg-blue-100" data-sort="name" onclick="sortTable('customer','name')">ê±°ë˜ì²˜ëª…<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right text-cyan-700 cursor-pointer hover:bg-blue-100" data-sort="h2_buses" onclick="sortTable('customer','h2_buses')">ìˆ˜ì†Œë²„ìŠ¤<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right cursor-pointer hover:bg-blue-100" data-sort="total_kg" onclick="sortTable('customer','total_kg')"><span id="monthHeaderLabel">11ì›”</span> ì¶©ì „ëŸ‰<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right bg-gray-100 cursor-pointer hover:bg-blue-100" data-sort="change_kg" onclick="sortTable('customer','change_kg')">ì „ì›”ëŒ€ë¹„<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right bg-gray-100 cursor-pointer hover:bg-blue-100" data-sort="change_pct" onclick="sortTable('customer','change_pct')">ì¦ê°ë¥ <span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right text-amber-600 cursor-pointer hover:bg-blue-100" data-sort="cost_vat" onclick="sortTable('customer','cost_vat')">ì¶©ì „ê¸ˆì•¡(VAT)<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right text-green-600 cursor-pointer hover:bg-blue-100" data-sort="subsidy" onclick="sortTable('customer','subsidy')">ìœ ê°€ë³´ì¡°ê¸ˆ<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right cursor-pointer hover:bg-blue-100" data-sort="charge_count" onclick="sortTable('customer','charge_count')">ì¶©ì „íšŸìˆ˜<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right cursor-pointer hover:bg-blue-100" data-sort="avg_per_charge" onclick="sortTable('customer','avg_per_charge')">1íšŒ ì¶©ì „ëŸ‰<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right cursor-pointer hover:bg-blue-100" data-sort="road_distance_km" onclick="sortTable('customer','road_distance_km')">í¬ê³¡ ê±°ë¦¬<span class="sort-icon text-gray-400"> â–³</span></th>
                                <th class="px-3 py-2 text-right bg-amber-50 cursor-pointer hover:bg-amber-100" data-sort="ext_avg_distance" onclick="sortTable('customer','ext_avg_distance')">ê¸°ì¡´ í‰ê· <span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right bg-amber-50 cursor-pointer hover:bg-amber-100" data-sort="distance_change" onclick="sortTable('customer','distance_change')">ê±°ë¦¬ ë³€í™”<span class="sort-icon text-gray-400"> â‡…</span></th>
                            </tr>
                        </thead>
                        <tbody id="customerTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab Content: Potential (Coupang FC) -->
            <div class="tab-content" id="tab-potential">
                <div class="p-4 bg-orange-50 border-b">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-orange-800">ì ì¬ê³ ê° - ì¿ íŒ¡ ë¬¼ë¥˜ì„¼í„° (FC)</h3>
                            <p class="text-xs text-orange-600 mt-1">ìˆ˜ì†Œë²„ìŠ¤ (ì§ì˜) ìš´í–‰ ê°€ëŠ¥ì„±</p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-orange-700" id="fcNearbyCount">16<span class="text-sm">ê°œ</span></div>
                            <div class="text-xs text-orange-600">ì „ì²´</div>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 sticky top-0" id="potentialTableHeaders">
                            <tr>
                                <th class="px-2 py-2 text-center w-10">#</th>
                                <th class="px-4 py-2 text-left cursor-pointer hover:bg-orange-100" data-sort="code" onclick="sortTable('potential','code')">FC ì½”ë“œ<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-4 py-2 text-left cursor-pointer hover:bg-orange-100" data-sort="name" onclick="sortTable('potential','name')">ì„¼í„°ëª…<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-4 py-2 text-right cursor-pointer hover:bg-orange-100" data-sort="kakao_km" onclick="sortTable('potential','kakao_km')">ë„ë¡œ ê±°ë¦¬<span class="sort-icon text-gray-400"> â–³</span></th>
                                <th class="px-4 py-2 text-right cursor-pointer hover:bg-orange-100" data-sort="kakao_min" onclick="sortTable('potential','kakao_min')">ì´ë™ì‹œê°„<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-4 py-2 text-center">ê·¼ë¬´ì¡°</th>
                            </tr>
                        </thead>
                        <tbody id="potentialTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab Content: Bus Depots -->
            <div class="tab-content" id="tab-depots">
                <div class="p-4 bg-purple-50 border-b">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-purple-800">ë²„ìŠ¤ ì°¨ê³ ì§€ (ì‹œë‚´/ê´‘ì—­/ì „ì„¸)</h3>
                            <p class="text-xs text-purple-600 mt-1">ìˆ˜ì†Œë²„ìŠ¤ ì „í™˜ ì ì¬ ì‹œì¥ | ì´ì²œì‹œë‚´ë²„ìŠ¤ ìˆ˜ì†Œë²„ìŠ¤ 7ëŒ€ ìš´í–‰ ì¤‘</p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-purple-700">7<span class="text-sm">ëŒ€</span></div>
                            <div class="text-xs text-purple-600">ìˆ˜ì†Œë²„ìŠ¤ ìš´í–‰ì¤‘</div>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 sticky top-0" id="depotTableHeaders">
                            <tr>
                                <th class="px-2 py-2 text-center w-10">#</th>
                                <th class="px-4 py-2 text-left cursor-pointer hover:bg-purple-100" data-sort="name" onclick="sortTable('depot','name')">ì°¨ê³ ì§€ëª…<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-4 py-2 text-left cursor-pointer hover:bg-purple-100" data-sort="company" onclick="sortTable('depot','company')">ìš´ì˜ì‚¬<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-4 py-2 text-center cursor-pointer hover:bg-purple-100" data-sort="type" onclick="sortTable('depot','type')">ìœ í˜•<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-4 py-2 text-right cursor-pointer hover:bg-purple-100" data-sort="road_distance_km" onclick="sortTable('depot','road_distance_km')">ë„ë¡œ ê±°ë¦¬<span class="sort-icon text-gray-400"> â–³</span></th>
                                <th class="px-4 py-2 text-center cursor-pointer hover:bg-purple-100" data-sort="h2_buses" onclick="sortTable('depot','h2_buses')">ìˆ˜ì†Œë²„ìŠ¤<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-4 py-2 text-left">ë¹„ê³ </th>
                            </tr>
                        </thead>
                        <tbody id="depotTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab Content: Charging Stations -->
            <div class="tab-content" id="tab-stations">
                <div class="p-4 bg-green-50 border-b">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-green-800">ì¶©ì „ì†Œë³„ ì´ìš© í˜„í™© (11ì›”)</h3>
                            <p class="text-xs text-green-600 mt-1">ì›ë”ëª¨ë¹Œë¦¬í‹° ì†Œì† ìˆ˜ì†Œë²„ìŠ¤ íƒ€ì‚¬ ì¶©ì „ì†Œ ì´ìš© í˜„í™©</p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-green-700">21,766<span class="text-sm">kg</span></div>
                            <div class="text-xs text-green-600">ì´ ì¶©ì „ëŸ‰</div>
                        </div>
                    </div>
                    <!-- 1kg í‰ê·  ê°€ê²© -->
                    <div class="flex justify-end gap-4 mt-2 text-xs">
                        <span class="text-gray-600">1kg í‰ê· : <strong class="text-green-700">11,231ì›</strong>(VAT) / <strong class="text-green-600">10,210ì›</strong>(ì„¸ì „)</span>
                    </div>
                    <!-- ê¸ˆì•¡ ì •ë³´ -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3 pt-3 border-t border-green-200">
                        <div class="text-center">
                            <div class="text-sm font-bold text-gray-700">244,467,654<span class="text-xs">ì›</span></div>
                            <div class="text-[10px] text-gray-500">ì´ ì¶©ì „ê¸ˆì•¡ (VATí¬í•¨)</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-blue-600">108,831,900<span class="text-xs">ì›</span></div>
                            <div class="text-[10px] text-blue-500">ìœ ê°€ë³´ì¡°ê¸ˆ (1kgë‹¹ 5,000ì›)</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-red-600">139,558,704<span class="text-xs">ì›</span></div>
                            <div class="text-[10px] text-red-500">íšŒì‚¬ë¶€ë‹´ê¸ˆ (VATí¬í•¨)</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-bold text-amber-600">126,871,549<span class="text-xs">ì›</span></div>
                            <div class="text-[10px] text-amber-500">íšŒì‚¬ë¶€ë‹´ê¸ˆ (VATì œì™¸)</div>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 sticky top-0" id="stationTableHeaders">
                            <tr>
                                <th class="px-2 py-2 text-center w-10">#</th>
                                <th class="px-4 py-2 text-left cursor-pointer hover:bg-green-100" data-sort="name" onclick="sortTable('station','name')">ì¶©ì „ì†Œëª…<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right cursor-pointer hover:bg-green-100" data-sort="total_kg" onclick="sortTable('station','total_kg')">ì›” ì¶©ì „ëŸ‰<span class="sort-icon text-gray-400"> â–½</span></th>
                                <th class="px-3 py-2 text-right">ì¼ ì¶©ì „ëŸ‰</th>
                                <th class="px-3 py-2 text-right cursor-pointer hover:bg-green-100" data-sort="count" onclick="sortTable('station','count')">ì¶©ì „íšŸìˆ˜<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right">ì¼ ë°©ë¬¸</th>
                                <th class="px-3 py-2 text-right cursor-pointer hover:bg-green-100" data-sort="price_per_kg" onclick="sortTable('station','price_per_kg')">1kg ê°€ê²©<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right">ì›” ì¶©ì „ê¸ˆì•¡</th>
                                <th class="px-3 py-2 text-right text-green-600 cursor-pointer hover:bg-green-100" data-sort="subsidy" onclick="sortTable('station','subsidy')">ìœ ê°€ë³´ì¡°ê¸ˆ<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right cursor-pointer hover:bg-green-100" data-sort="road_distance_km" onclick="sortTable('station','road_distance_km')">ë„ë¡œê±°ë¦¬<span class="sort-icon text-gray-400"> â‡…</span></th>
                                <th class="px-3 py-2 text-right">ì ìœ ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody id="stationTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- ì´ìš©ë°©ë²• ëª¨ë‹¬ -->
    <div id="helpModal" class="fixed inset-0 z-[100000] hidden">
        <!-- ì˜¤ë²„ë ˆì´ -->
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeHelpModal()"></div>

        <!-- ëª¨ë‹¬ ì»¨í…ì¸  -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-3xl max-h-[85vh] bg-white rounded-2xl shadow-2xl overflow-hidden mx-4">
            <!-- í—¤ë” -->
            <div class="bg-gradient-to-r from-slate-900 via-blue-900 to-slate-900 text-white px-6 py-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold flex items-center gap-2">
                        <span>ğŸ“–</span> ëŒ€ì‹œë³´ë“œ ì´ìš©ë°©ë²•
                    </h2>
                    <button onclick="closeHelpModal()" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="border-b bg-gray-50">
                <div class="flex overflow-x-auto">
                    <button class="help-tab active" onclick="switchHelpTab(this, 'overview')">ğŸ“Š ê°œìš”</button>
                    <button class="help-tab" onclick="switchHelpTab(this, 'map')">ğŸ—ºï¸ ì§€ë„</button>
                    <button class="help-tab" onclick="switchHelpTab(this, 'simulation')">âš™ï¸ ì‹œë®¬ë ˆì´ì…˜</button>
                    <button class="help-tab" onclick="switchHelpTab(this, 'charts')">ğŸ“ˆ ì°¨íŠ¸</button>
                    <button class="help-tab" onclick="switchHelpTab(this, 'tables')">ğŸ“‹ ë°ì´í„°</button>
                </div>
            </div>

            <!-- ì»¨í…ì¸  ì˜ì—­ -->
            <div class="overflow-y-auto max-h-[60vh] p-6">
                <!-- ê°œìš” íƒ­ -->
                <div id="help-overview" class="help-content">
                    <h3>ğŸ“Š ëŒ€ì‹œë³´ë“œ ì†Œê°œ</h3>
                    <p class="text-gray-600 mb-4">ì›ë”ì—ë„ˆì§€ í¬ê³¡ ì‚¼ê³„ë¦¬ ìˆ˜ì†Œì¶©ì „ì†Œ(2026.10 ì˜¤í”ˆ ì˜ˆì •)ì˜ ìˆ˜ìš” ë¶„ì„ ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.</p>

                    <h3>ğŸ†• v5.1 ì—…ë°ì´íŠ¸</h3>
                    <ul>
                        <li><strong>ê±°ë¦¬ ë¹„êµ ë¶„ì„</strong>: í¬ê³¡ ê±°ë¦¬ vs ê¸°ì¡´ì¶©ì „ì†Œ í‰ê· ê±°ë¦¬ ë¹„êµ</li>
                        <li><strong>ì¶©ì „ì†Œ ìƒì„¸ íˆ´íŒ</strong>: ê±°ë˜ì²˜ í–‰ì— ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ì´ìš© ì¶©ì „ì†Œë³„ ì¶©ì „ëŸ‰/ê±°ë¦¬ í‘œì‹œ</li>
                        <li><strong>Kakao API ë„ë¡œê±°ë¦¬</strong>: ì™¸ë¶€ ì¶©ì „ì†Œê¹Œì§€ ì‹¤ì œ ë„ë¡œê±°ë¦¬ ê³„ì‚°</li>
                    </ul>

                    <h3>ğŸ—“ï¸ ì›”ë³„ ë°ì´í„° ì „í™˜</h3>
                    <ul>
                        <li>ìƒë‹¨ í—¤ë”ì˜ <strong>10ì›” / 11ì›”</strong> íƒ­ìœ¼ë¡œ ì›”ë³„ ë°ì´í„° ì „í™˜</li>
                        <li>í—¤ë”ê°€ <strong>ê³ ì •(Sticky)</strong>ë˜ì–´ ìŠ¤í¬ë¡¤ ì¤‘ì—ë„ ì–¸ì œë“  ì›” ë³€ê²½ ê°€ëŠ¥</li>
                        <li>ì „í™˜ ì‹œ ê±°ë˜ì²˜, ë²•ì¸ë³„ ì¶©ì „ëŸ‰, ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ë“± ëª¨ë“  ë°ì´í„° ìë™ ê°±ì‹ </li>
                        <li>11ì›” ì„ íƒ ì‹œ <strong>ì „ì›”ëŒ€ë¹„/ì¦ê°ë¥ </strong> ì»¬ëŸ¼ ì¶”ê°€ í‘œì‹œ</li>
                    </ul>

                    <h3>ìƒë‹¨ ìš”ì•½ ì¹´ë“œ</h3>
                    <table>
                        <thead>
                            <tr><th>ì¹´ë“œ</th><th>ì„¤ëª…</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>ğŸšŒ ìˆ˜ì†Œë²„ìŠ¤ ëŒ€ìˆ˜</td><td>ì›ë”ëª¨ë¹Œë¦¬í‹° ì†Œì† ìˆ˜ì†Œë²„ìŠ¤ ì´ ëŒ€ìˆ˜ (ì›”ë³„ ë³€ë™)</td></tr>
                            <tr><td>ğŸ¯ ì ì¬ê³ ê°</td><td><strong>ë„ë¡œê±°ë¦¬ 30km ì´ë‚´</strong> ì¿ íŒ¡ ë¬¼ë¥˜ì„¼í„° ìˆ˜ (16ê°œì†Œ)</td></tr>
                            <tr><td>ğŸšŒ ë²„ìŠ¤ ì°¨ê³ ì§€</td><td>ì¸ê·¼ ì‹œë‚´/ê´‘ì—­ë²„ìŠ¤ ì°¨ê³ ì§€ (ìˆ˜ì†Œë²„ìŠ¤ ì „í™˜ ì ì¬ ìˆ˜ìš”)</td></tr>
                            <tr><td>ğŸ’§ ì£¼ë³€ ìˆ˜ì†Œë²„ìŠ¤</td><td>íƒ€ ìš´ìˆ˜ì‚¬ ìš´í–‰ ìˆ˜ì†Œë²„ìŠ¤ (ì´ì²œì‹œë‚´ë²„ìŠ¤ ë“±)</td></tr>
                            <tr><td>â›½ ì›”ê°„ ì¶©ì „ëŸ‰</td><td>ì„ íƒ ì›” ì›ë” ì „ì²´ ì¶©ì „ëŸ‰ (11ì›”: ì „ì›” ëŒ€ë¹„ ì¦ê° í‘œì‹œ)</td></tr>
                            <tr><td>ğŸ“Š MTOP ëª©í‘œ</td><td>ì›”ê°„ ìµœì†Œ ê³„ì•½ëŸ‰ (ì—ë„ˆí•˜ì´ MTOP ê¸°ì¤€)</td></tr>
                        </tbody>
                    </table>
                    <div class="tip">ğŸ’¡ <strong>ë°ì´í„° ì¶œì²˜</strong>: 2024ë…„ 10ì›”/11ì›” ìˆ˜ì†Œì¶©ì „í˜„í™© Excel</div>
                </div>

                <!-- ì§€ë„ íƒ­ -->
                <div id="help-map" class="help-content hidden">
                    <h3>ğŸ—ºï¸ í¬ê³¡ì ì‚¬ì—…ë¶€ì§€ ì£¼ë³€ ì‹œê°í™” ì‚¬ìš©ë²•</h3>

                    <h3>ğŸ¯ ì›ìœ„ì¹˜ ë²„íŠ¼</h3>
                    <ul>
                        <li>ì§€ë„ë¥¼ ì´ë™/í™•ëŒ€ í›„ <strong>ì›ìœ„ì¹˜</strong> ë²„íŠ¼ í´ë¦­</li>
                        <li>ì›ë”ì—ë„ˆì§€(í¬ê³¡) ìˆ˜ì†Œì¶©ì „ì†Œ ì¤‘ì‹¬ìœ¼ë¡œ ë³µê·€</li>
                        <li>ì´ˆê¸° ì¤Œ ë ˆë²¨(10)ë¡œ ë¦¬ì…‹</li>
                    </ul>

                    <h3>ë°˜ê²½ ìŠ¬ë¼ì´ë”</h3>
                    <ul>
                        <li>5km ~ 50km ë²”ìœ„ ì¡°ì ˆ</li>
                        <li>ì¶©ì „ì†Œ ê¸°ì¤€ ì›í˜• ë²”ìœ„ í‘œì‹œ</li>
                        <li>ë°˜ê²½ ë‚´ ê±°ë˜ì²˜/ì ì¬ê³ ê° ìë™ í•„í„°ë§</li>
                    </ul>

                    <h3>ë ˆì´ì–´ í† ê¸€</h3>
                    <table>
                        <thead>
                            <tr><th>ì²´í¬ë°•ìŠ¤</th><th>í‘œì‹œ ë‚´ìš©</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>âœ… ì¶©ì „ì†Œ</td><td>í¬ê³¡ ì‚¼ê³„ë¦¬ ì¶©ì „ì†Œ ìœ„ì¹˜ (ë¹¨ê°„ ë³„ ë§ˆì»¤)</td></tr>
                            <tr><td>âœ… ê±°ë˜ì²˜</td><td>í˜„ì¬ ìˆ˜ì†Œë²„ìŠ¤ ìš´í–‰ ê±°ë˜ì²˜ (íŒŒë€ìƒ‰)</td></tr>
                            <tr><td>âœ… ì ì¬ê³ ê°</td><td>ì¿ íŒ¡ ë¬¼ë¥˜ì„¼í„° (ì£¼í™©ìƒ‰ ë‹¤ì´ì•„ëª¬ë“œ)</td></tr>
                            <tr><td>âœ… ë²„ìŠ¤ì°¨ê³ ì§€</td><td>ì‹œë‚´/ê´‘ì—­ë²„ìŠ¤ ì°¨ê³ ì§€ (ë³´ë¼ìƒ‰ ìœ¡ê°í˜•)</td></tr>
                        </tbody>
                    </table>

                    <h3>ë§ˆì»¤ ìƒ‰ìƒ ì˜ë¯¸ (ê±°ë¦¬ ê¸°ì¤€)</h3>
                    <ul>
                        <li>ğŸŸ¢ <strong>ë…¹ìƒ‰</strong>: 10km ì´ë‚´</li>
                        <li>ğŸŸ¡ <strong>ë…¸ë€ìƒ‰</strong>: 10~30km</li>
                        <li>ğŸŸ  <strong>ì£¼í™©ìƒ‰</strong>: 30km ì´ìƒ</li>
                        <li>ğŸ”µ <strong>ì²­ìƒ‰ í…Œë‘ë¦¬</strong>: ìˆ˜ì†Œë²„ìŠ¤ ìš´í–‰ ì¤‘</li>
                        <li>ğŸ”´ <strong>ë¹¨ê°„ í…Œë‘ë¦¬</strong>: 3êµëŒ€ ìš´ì˜</li>
                    </ul>
                    <div class="tip">ğŸ’¡ <strong>ë§ˆì»¤ í´ë¦­</strong> ì‹œ ìƒì„¸ ì •ë³´ íŒì—… í‘œì‹œ</div>
                </div>

                <!-- ì‹œë®¬ë ˆì´ì…˜ íƒ­ -->
                <div id="help-simulation" class="help-content hidden">
                    <h3>âš™ï¸ ì‹œë®¬ë ˆì´ì…˜ ê¸°ëŠ¥</h3>

                    <h3>ì¼ê°„ ëª©í‘œ ì„¤ì •</h3>
                    <ul>
                        <li>ìŠ¬ë¼ì´ë” ë˜ëŠ” ì…ë ¥ë€ì— ì¼ì¼ ëª©í‘œ ì¶©ì „ëŸ‰ ì…ë ¥ (100kg ë‹¨ìœ„)</li>
                        <li>ì›”ê°„ ëª©í‘œ ìë™ ê³„ì‚° (ì¼ê°„ Ã— 30ì¼)</li>
                        <li>MTOP ì¶©ì¡±ë¥  ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸</li>
                    </ul>

                    <h3>MTOP ì¶©ì¡±ë¥  ê³„ì‚°</h3>
                    <ul>
                        <li><strong>ì˜ˆìƒ ì¶©ì „ëŸ‰</strong> = ë°˜ê²½ ë‚´ ê±°ë˜ì²˜ ì›”ê°„ ì¶©ì „ëŸ‰ í•©ê³„</li>
                        <li><strong>ì¶©ì¡±ë¥ </strong> = (ì˜ˆìƒ ì¶©ì „ëŸ‰ Ã· MTOP ëª©í‘œ) Ã— 100%</li>
                        <li><strong>í•„ìš” ë²„ìŠ¤ ëŒ€ìˆ˜</strong> = ë¶€ì¡±ëŸ‰ Ã· 247.86kg (í‰ê·  ì›”ê°„ ì¶©ì „ëŸ‰/ëŒ€)</li>
                    </ul>

                    <h3>MTOP ìƒíƒœ ë©”ì‹œì§€</h3>
                    <table>
                        <thead>
                            <tr><th>ì¶©ì¡±ë¥ </th><th>ìƒíƒœ</th><th>ê¶Œì¥ ì¡°ì¹˜</th></tr>
                        </thead>
                        <tbody>
                            <tr><td class="text-green-600">â‰¥100%</td><td>ğŸŸ¢ ëª©í‘œ ë‹¬ì„±</td><td>ì•ˆì •ì  ìˆ˜ìµ êµ¬ì¡° í™•ë³´</td></tr>
                            <tr><td class="text-blue-600">70~99%</td><td>ğŸ”µ ë‹¬ì„± ê·¼ì ‘</td><td>ì¶”ê°€ ì˜ì—…ìœ¼ë¡œ ë‹¬ì„± ê°€ëŠ¥ (ì•½ NëŒ€)</td></tr>
                            <tr><td class="text-yellow-600">40~69%</td><td>ğŸŸ¡ ì˜ì—… í•„ìš”</td><td>ì ê·¹ì  ê±°ë˜ì²˜ ì˜ì—… í•„ìš”</td></tr>
                            <tr><td class="text-red-600">&lt;40%</td><td>ğŸ”´ ë°œêµ´ ìš°ì„ </td><td>ì‹ ê·œ ê±°ë˜ì²˜ ë°œêµ´ / MTOP ë‹¨ê³„ ì¬ê²€í† </td></tr>
                        </tbody>
                    </table>

                    <h3>ë°˜ê²½ ë‚´ ê±°ë˜ì²˜ ìƒì„¸</h3>
                    <p class="text-gray-600">ë°˜ê²½ ì¡°ì ˆ ì‹œ í•´ë‹¹ ë²”ìœ„ ë‚´ ê±°ë˜ì²˜ë§Œ í…Œì´ë¸”ì— í‘œì‹œ:</p>
                    <ul>
                        <li>ê±°ë˜ì²˜ëª…, ìˆ˜ì†Œë²„ìŠ¤ ëŒ€ìˆ˜, ì¶©ì „ëŸ‰, ë„ë¡œê±°ë¦¬</li>
                    </ul>
                    <div class="tip">ğŸ’¡ <strong>ì˜ì—… ëª©í‘œ</strong>: 2026ë…„ 10ì›” ì˜¤í”ˆê¹Œì§€ ì¶©ë¶„í•œ ìˆ˜ì†Œë²„ìŠ¤ ê³ ê° í™•ë³´ê°€ í•µì‹¬</div>
                </div>

                <!-- ì°¨íŠ¸ íƒ­ -->
                <div id="help-charts" class="help-content hidden">
                    <h3>ğŸ“ˆ ì°¨íŠ¸ ë¶„ì„</h3>

                    <h3>ë²•ì¸ë³„ ì¶©ì „ëŸ‰ (ë„ë„› ì°¨íŠ¸)</h3>
                    <ul>
                        <li>ì°¨íŠ¸ ë‚´ë¶€ì— <strong>ë²•ì¸ëª… ë° ë¹„ìœ¨(%)</strong> ì§ì ‘ í‘œì‹œ</li>
                        <li>ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ì¶©ì „ëŸ‰(kg) ë° ì •í™•í•œ ë¹„ìœ¨ íˆ´íŒ í‘œì‹œ</li>
                        <li><strong>ì˜¨ë²„ìŠ¤</strong>: ì£¼ë ¥ ë²•ì¸ (ì•½ 83% ë¹„ì¤‘)</li>
                        <li><strong>ì›ë”ì˜¨</strong>: ì¤‘í˜• ë²•ì¸ (ì•½ 10%)</li>
                        <li><strong>ì˜¨ëª¨</strong>: ì†Œí˜• ë²•ì¸ (ì•½ 7%)</li>
                        <li>ì›”ë³„ ì „í™˜ ì‹œ ì°¨íŠ¸ ë°ì´í„° ìë™ ê°±ì‹ </li>
                        <li>í•˜ë‹¨ í…Œì´ë¸”ì—ì„œ ê±°ë˜ì²˜ìˆ˜/ë²„ìŠ¤/ì¶©ì „ëŸ‰/íšŸìˆ˜/ì¼í‰ê· /ì¶©ì „ì£¼ê¸° ìƒì„¸ í™•ì¸</li>
                    </ul>

                    <h3>ê±°ë˜ì²˜ë³„ ì¶©ì „ëŸ‰ (ë§‰ëŒ€ ê·¸ë˜í”„)</h3>
                    <ul>
                        <li>ìƒìœ„ 5ê°œ / 10ê°œ / ì „ì²´ ì„ íƒ ê°€ëŠ¥</li>
                        <li>ì¶©ì „ëŸ‰ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬</li>
                        <li>ë§‰ëŒ€ ë¼ë²¨ì— <strong>ë²„ìŠ¤ëŒ€ìˆ˜, ì¶©ì „íšŸìˆ˜</strong> í•¨ê»˜ í‘œì‹œ</li>
                        <li>ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ìƒì„¸ ìˆ˜ì¹˜ í‘œì‹œ</li>
                        <li><strong>ëª¨ë°”ì¼</strong>: ë™ì  ë†’ì´ ì¡°ì ˆë¡œ ìµœì í™” í‘œì‹œ</li>
                    </ul>
                    <div class="tip">ğŸ’¡ <strong>ì¸ì‚¬ì´íŠ¸</strong>: ì‚¼ì„±ì „ì(ìˆ˜ì›)ì´ ì „ì²´ ì¶©ì „ëŸ‰ì˜ ì•½ 36% ì°¨ì§€</div>
                </div>

                <!-- ë°ì´í„° íƒ­ -->
                <div id="help-tables" class="help-content hidden">
                    <h3>ğŸ“‹ ë°ì´í„° í…Œì´ë¸”</h3>

                    <h3>ğŸ¢ í˜„ì¬ ê±°ë˜ì²˜ íƒ­</h3>
                    <p class="text-gray-600">ì›ë”ëª¨ë¹Œë¦¬í‹° ì†Œì† ê±°ë˜ì²˜ ìƒì„¸ (10ì›”: 16ê°œ, 11ì›”: 15ê°œ):</p>
                    <ul>
                        <li>ìˆ˜ì†Œë²„ìŠ¤ ëŒ€ìˆ˜, ì›”ê°„ ì¶©ì „ëŸ‰, ì¶©ì „íšŸìˆ˜</li>
                        <li><strong class="text-amber-600">ì¶©ì „ê¸ˆì•¡(VAT)</strong>, <strong class="text-blue-600">ìœ ê°€ë³´ì¡°ê¸ˆ</strong> - ì‹¤ì œ ì²­êµ¬ ê¸ˆì•¡</li>
                        <li>1íšŒ ì¶©ì „ëŸ‰, ë„ë¡œê±°ë¦¬ ë° ì´ë™ì‹œê°„</li>
                        <li><strong>í¬ê³¡ ê±°ë¦¬</strong>: í¬ê³¡ ì¶©ì „ì†Œê¹Œì§€ ë„ë¡œê±°ë¦¬</li>
                        <li><strong>ê¸°ì¡´ì¶©ì „ì†Œ í‰ê· </strong>: í•´ë‹¹ ì›” ì´ìš© ì¶©ì „ì†Œë“¤ì˜ ê°€ì¤‘í‰ê·  ê±°ë¦¬</li>
                        <li><strong>ê±°ë¦¬ ë³€í™”</strong>: í¬ê³¡ ì „í™˜ ì‹œ ê±°ë¦¬ ì¦ê° (ë…¹ìƒ‰: ê°€ê¹Œì›Œì§, ë¹¨ê°„ìƒ‰: ë©€ì–´ì§)</li>
                        <li><strong>11ì›” ì „ìš©</strong>: ì „ì›”ëŒ€ë¹„(kg), ì¦ê°ë¥ (%) ì»¬ëŸ¼ ì¶”ê°€</li>
                        <li>ë°˜ê²½ ë‚´ ê±°ë˜ì²˜ ë…¹ìƒ‰ í•˜ì´ë¼ì´íŠ¸</li>
                        <li><strong>ê³ ê° ì´íƒˆ</strong>: DL E&C (11ì›” ì¶©ì „ ì—†ìŒ)</li>
                    </ul>
                    <div class="tip">ğŸ’¡ <strong>ë§ˆìš°ìŠ¤ í˜¸ë²„</strong>: ê±°ë˜ì²˜ í–‰ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ í•´ë‹¹ ê±°ë˜ì²˜ê°€ ì´ìš©í•œ ì¶©ì „ì†Œë³„ ì¶©ì „ëŸ‰ê³¼ ê±°ë¦¬ ì •ë³´ê°€ íˆ´íŒìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>

                    <h3>ğŸ¯ ì ì¬ê³ ê° íƒ­</h3>
                    <p class="text-gray-600">ì¿ íŒ¡ ë¬¼ë¥˜ì„¼í„°(FC) 28ê°œì†Œ (ë„ë¡œê±°ë¦¬ 30km ì´ë‚´: 16ê°œ):</p>
                    <ul>
                        <li>FC ì½”ë“œ, ì„¼í„°ëª…, ë„ë¡œê±°ë¦¬, ì´ë™ì‹œê°„</li>
                        <li>ê·¼ë¬´ì¡° (Day/Swing/Night) ì •ë³´</li>
                        <li>ë°˜ê²½ ë‚´ í•­ëª© ë…¹ìƒ‰ í•˜ì´ë¼ì´íŠ¸</li>
                    </ul>

                    <h3>ğŸšŒ ë²„ìŠ¤ ì°¨ê³ ì§€ íƒ­</h3>
                    <p class="text-gray-600">ì£¼ë³€ 5ê°œ ë²„ìŠ¤ ì°¨ê³ ì§€:</p>
                    <ul>
                        <li>ìš´ì˜ì‚¬, ìœ í˜•(ì‹œë‚´/ê´‘ì—­/ì „ì„¸), ìˆ˜ì†Œë²„ìŠ¤ ë³´ìœ  í˜„í™©</li>
                        <li>ë„ë¡œê±°ë¦¬ ë° ì´ë™ì‹œê°„ (ë°˜ê²½ ë‚´ ë…¹ìƒ‰ í•˜ì´ë¼ì´íŠ¸)</li>
                    </ul>

                    <h3>â›½ íƒ€ì‚¬ ì¶©ì „ì†Œ ì´ìš© í˜„í™© íƒ­</h3>
                    <p class="text-gray-600">ì›ë” ì°¨ëŸ‰ì˜ íƒ€ì‚¬ ì¶©ì „ì†Œ ì´ìš© ë‚´ì—­ (14ê°œì†Œ):</p>
                    <ul>
                        <li>ì¶©ì „ì†Œë³„ ì›”/ì¼ ì¶©ì „ëŸ‰, ì¶©ì „íšŸìˆ˜, ì¼ ë°©ë¬¸ì°¨ëŸ‰</li>
                        <li>1kg ê°€ê²©, ì›” ì¶©ì „ê¸ˆì•¡</li>
                        <li><strong class="text-green-600">ìœ ê°€ë³´ì¡°ê¸ˆ</strong> (1kgë‹¹ 5,000ì›)</li>
                        <li><strong>ë„ë¡œê±°ë¦¬ ë° ì´ë™ì‹œê°„</strong></li>
                        <li>ì ìœ ìœ¨ ì‹œê°í™” (ë§‰ëŒ€ ê·¸ë˜í”„)</li>
                    </ul>
                    <div class="tip">ğŸ’¡ <strong>í—¤ë” ì˜ì—­</strong>: ì´ ì¶©ì „ê¸ˆì•¡, ìœ ê°€ë³´ì¡°ê¸ˆ(108,831,900ì›), íšŒì‚¬ë¶€ë‹´ê¸ˆ ìš”ì•½ í‘œì‹œ</div>

                    <h3>ğŸ”„ í…Œì´ë¸” ì •ë ¬ ê¸°ëŠ¥ (3ë‹¨ê³„)</h3>
                    <p class="text-gray-600">ëª¨ë“  í…Œì´ë¸”ì—ì„œ ì»¬ëŸ¼ í—¤ë” í´ë¦­ìœ¼ë¡œ ì •ë ¬:</p>
                    <ul>
                        <li><strong>1ë‹¨ê³„</strong>: ì˜¤ë¦„ì°¨ìˆœ <span class="text-blue-600 font-bold">â–²</span></li>
                        <li><strong>2ë‹¨ê³„</strong>: ë‚´ë¦¼ì°¨ìˆœ <span class="text-blue-600 font-bold">â–¼</span></li>
                        <li><strong>3ë‹¨ê³„</strong>: ê¸°ë³¸ê°’ ë³µê·€ <span class="text-gray-400">â–³/â–½</span></li>
                    </ul>
                    <table class="mt-2">
                        <thead>
                            <tr><th>ì•„ì´ì½˜</th><th>ì˜ë¯¸</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><span class="text-blue-600 font-bold">â–² â–¼</span></td><td>ì‚¬ìš©ì ì§€ì • ì •ë ¬ (íŒŒë€ìƒ‰)</td></tr>
                            <tr><td><span class="text-gray-400">â–³ â–½</span></td><td>ê¸°ë³¸ ì •ë ¬ (íšŒìƒ‰)</td></tr>
                            <tr><td><span class="text-gray-300">â‡…</span></td><td>ë¯¸ì •ë ¬</td></tr>
                        </tbody>
                    </table>
                    <div class="tip">ğŸ’¡ <strong>ì •ë ¬ ì˜ˆì‹œ</strong>: ì¶©ì „ê¸ˆì•¡(VAT) í´ë¦­ â†’ ì˜¤ë¦„ì°¨ìˆœ â†’ ë‚´ë¦¼ì°¨ìˆœ â†’ ê¸°ë³¸ê°’</div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-gray-400 text-sm py-4 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p id="footerDataLabel">ì›ë”ì—ë„ˆì§€ ìˆ˜ì†Œì¶©ì „ì†Œ ì‹œë®¬ë ˆì´ì…˜ ëŒ€ì‹œë³´ë“œ v5.1 | ë°ì´í„° ê¸°ì¤€: 2025ë…„ 11ì›”</p>
        </div>
    </footer>

    <!-- Station Usage Tooltip -->
    <div id="stationTooltip" class="station-tooltip"></div>

    <script>
        // ========== DATA ==========
        const POGOK_STATION = {
            name: 'ì›ë”ì—ë„ˆì§€(í¬ê³¡) ìˆ˜ì†Œì¶©ì „ì†Œ',
            lat: 37.285019,
            lng: 127.231434,
            status: 'planned',
            openDate: '2026ë…„ 10ì›”'
        };

        // ========== HAVERSINE FORMULA (ì§ì„ ê±°ë¦¬ ê³„ì‚°) ==========
        // ë‘ ì¢Œí‘œ ê°„ì˜ ì§ì„ ê±°ë¦¬(km) ê³„ì‚°
        function getDistanceFromStation(lat, lng) {
            const R = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
            const dLat = (lat - POGOK_STATION.lat) * Math.PI / 180;
            const dLng = (lng - POGOK_STATION.lng) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(POGOK_STATION.lat * Math.PI / 180) * Math.cos(lat * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; // ì§ì„ ê±°ë¦¬ (km)
        }

        const COMPANIES = {
            'ì˜¨ë²„ìŠ¤': {
                total_kg: 18052.74,
                color: '#3B82F6',
                customers: 10,      // ê±°ë˜ì²˜ìˆ˜
                vehicles: 71,       // ë²„ìŠ¤ëŒ€ìˆ˜
                charge_count: 898,  // ì¶©ì „íšŸìˆ˜
                daily_avg: 601.76,  // ì¼í‰ê·  (total_kg / 30)
                charge_cycle: 2.37  // ì¶©ì „ì£¼ê¸°
            },
            'ì›ë”ì˜¨': {
                total_kg: 2164.85,
                color: '#10B981',
                customers: 3,
                vehicles: 8,
                charge_count: 107,
                daily_avg: 72.16,
                charge_cycle: 2.24
            },
            'ì˜¨ëª¨': {
                total_kg: 1548.80,
                color: '#8B5CF6',
                customers: 1,
                vehicles: 2,
                charge_count: 107,
                daily_avg: 51.63,
                charge_cycle: 0.56
            }
        };

        // ========== ì›”ë³„ ì‹œê³„ì—´ ë°ì´í„° ==========
        // ë°ì´í„° ì¶œì²˜: charging_history.json (build_timeseries_data.pyë¡œ ìƒì„±)
        let currentMonth = '2024-11';

        // ê±°ë˜ì²˜ë³„ ê¸°ë³¸ ì •ë³´ (ì¢Œí‘œ, ë²„ìŠ¤ ëŒ€ìˆ˜, ë„ë¡œ ê±°ë¦¬ ë“±ì€ ê³ ì •)
        const CUSTOMER_INFO = {
            'ì‚¼ì„±ì „ì(ìˆ˜ì›)': { lat: 37.252728, lng: 127.059786, h2_buses: 25, road_distance_km: 23.7, road_time_min: 42 },
            'ì‚¼ì„±ë””ì§€í„¸ì‹œí‹°(ìˆ˜ì›)': { lat: 37.252728, lng: 127.059786, h2_buses: 25, road_distance_km: 23.7, road_time_min: 42 },
            'ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸': { lat: 37.465505, lng: 126.388662, h2_buses: 5, road_distance_km: 101.5, road_time_min: 115 },
            'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤': { lat: 37.367290, lng: 126.658293, h2_buses: 11, road_distance_km: 70.2, road_time_min: 95 },
            'ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)': { lat: 37.293101, lng: 127.202198, h2_buses: 5, road_distance_km: 5.0, road_time_min: 12 },
            'í‰íƒë¯¸êµ°ìŠ¤ì¿¨': { lat: 36.9664986, lng: 127.0125360, h2_buses: 5, road_distance_km: 40.0, road_time_min: 55 },
            'í‰íƒ ë¯¸êµ°ìŠ¤ì¿¨': { lat: 36.9664986, lng: 127.0125360, h2_buses: 5, road_distance_km: 40.0, road_time_min: 55 },
            'ê²½ë³µì´ˆë“±í•™êµ': { lat: 37.549818, lng: 127.086820, h2_buses: 11, road_distance_km: 45.8, road_time_min: 77 },
            'ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤': { lat: 37.354440, lng: 126.667223, h2_buses: 4, road_distance_km: 69.5, road_time_min: 97 },
            'ì‚¼ì„±ì „ì(í‰íƒ)': { lat: 37.038463, lng: 127.056796, h2_buses: 4, road_distance_km: 50.5, road_time_min: 56 },
            'ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›': { lat: 37.351907, lng: 127.123217, h2_buses: 3, road_distance_km: 18.8, road_time_min: 42 },
            'í• ë ë£¨ì•¼êµíšŒ': { lat: 37.410411, lng: 127.156103, h2_buses: 2, road_distance_km: 21.9, road_time_min: 48 },
            'ê³ ëŒ€êµ¬ë¡œë³‘ì›': { lat: 37.492131, lng: 126.884740, h2_buses: 2, road_distance_km: 51.3, road_time_min: 91 },
            'ë¡¯ë°ë©´ì„¸ì ': { lat: 37.449174, lng: 126.450920, h2_buses: 1, road_distance_km: 96.9, road_time_min: 109 },
            'ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)': { lat: 37.512579, lng: 127.124999, h2_buses: 1, road_distance_km: 36.4, road_time_min: 63 },
            'ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)': { lat: 37.379416, lng: 127.115406, h2_buses: 1, road_distance_km: 27.5, road_time_min: 41 },
            'ìµœì„ ì–´í•™ì›(ì˜í†µ)': { lat: 37.254519, lng: 127.073461, h2_buses: 1, road_distance_km: 22.2, road_time_min: 37 },
            'DL E&C': { lat: 37.5665, lng: 126.9780, h2_buses: 1, road_distance_km: 55.0, road_time_min: 80 }
        };

        // ì›”ë³„ ì¶©ì „ ë°ì´í„°
        const MONTHLY_DATA = {
            '2024-10': {
                summary: { total_kg: 17201.31, total_count: 973, customer_count: 16, vehicle_count: 80 },
                vehicles_by_customer: {
                    'ì‚¼ì„±ì „ì(ìˆ˜ì›)': 24, 'ì‚¼ì„±ë””ì§€í„¸ì‹œí‹°(ìˆ˜ì›)': 24,
                    'ê²½ë³µì´ˆë“±í•™êµ': 11, 'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤': 11,
                    'ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)': 5, 'ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸': 5,
                    'ì‚¼ì„±ì „ì(í‰íƒ)': 4, 'í‰íƒë¯¸êµ°ìŠ¤ì¿¨': 4, 'í‰íƒ ë¯¸êµ°ìŠ¤ì¿¨': 4, 'ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤': 4,
                    'ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›': 3, 'í• ë ë£¨ì•¼êµíšŒ': 2, 'ê³ ëŒ€êµ¬ë¡œë³‘ì›': 2,
                    'ë¡¯ë°ë©´ì„¸ì ': 1, 'DL E&C': 1, 'ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)': 1, 'ìµœì„ ì–´í•™ì›(ì˜í†µ)': 1, 'ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)': 1
                },
                charging_stations: [
                    { name: 'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 5119.71, count: 26 },
                    { name: 'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 3275.47, count: 17 },
                    { name: 'ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 2460.40, count: 6 },
                    { name: 'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 1920.50, count: 12 },
                    { name: 'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 1545.69, count: 8 },
                    { name: 'í•˜ì´ë„· ì¸ì²œê³µí•­T1 ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 1071.60, count: 2 },
                    { name: 'í•˜ì´ë„· ì—ë²„ëœë“œ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 822.32, count: 3 },
                    { name: 'í•˜ì´ë„· Hêµ­íšŒ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 280.61, count: 1 },
                    { name: 'ì›”ê³¡ìˆ˜ì†Œì¶©ì „ì†Œ(ì£¼)', total_kg: 264.71, count: 2 },
                    { name: 'ì¸ì²œê·¸ë¦° ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 187.76, count: 1 },
                    { name: 'í•˜ì´ë„· ê´‘ëª…ì†Œí•˜ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 151.75, count: 1 },
                    { name: 'ì—ìŠ¤ì¼€ì´ í‰íƒëª¨ê³¡ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 100.89, count: 1 }
                ],
                companies: {
                    'ì˜¨ë²„ìŠ¤': {
                        total_kg: 14277.07,
                        color: '#3B82F6',
                        customers: 10,
                        vehicles: 68,
                        charge_count: 808,
                        daily_avg: 475.90,
                        charge_cycle: 2.52
                    },
                    'ì›ë”ì˜¨': {
                        total_kg: 1720.24,
                        color: '#10B981',
                        customers: 3,
                        vehicles: 8,
                        charge_count: 95,
                        daily_avg: 57.34,
                        charge_cycle: 2.53
                    },
                    'ì˜¨ëª¨': {
                        total_kg: 1204.00,
                        color: '#8B5CF6',
                        customers: 3,
                        vehicles: 4,
                        charge_count: 70,
                        daily_avg: 40.13,
                        charge_cycle: 1.71
                    }
                },
                customers: {
                    'ì‚¼ì„±ë””ì§€í„¸ì‹œí‹°(ìˆ˜ì›)': { total_kg: 6282.38, charge_count: 375, avg_per_charge: 16.75, charging_amount: 70798812, fuel_subsidy: 31517550 },
                    'ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸': { total_kg: 2769.74, charge_count: 153, avg_per_charge: 18.10, charging_amount: 31406035, fuel_subsidy: 13795300 },
                    'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤': { total_kg: 2163.67, charge_count: 108, avg_per_charge: 20.03, charging_amount: 24897199, fuel_subsidy: 10765850 },
                    'ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)': { total_kg: 1169.13, charge_count: 75, avg_per_charge: 15.59, charging_amount: 12854634, fuel_subsidy: 5814050 },
                    'ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤': { total_kg: 965.74, charge_count: 53, avg_per_charge: 18.22, charging_amount: 11139936, fuel_subsidy: 4801600 },
                    'ê²½ë³µì´ˆë“±í•™êµ': { total_kg: 858.14, charge_count: 37, avg_per_charge: 23.19, charging_amount: 9403350, fuel_subsidy: 4274250 },
                    'ì‚¼ì„±ì „ì(í‰íƒ)': { total_kg: 541.44, charge_count: 31, avg_per_charge: 17.47, charging_amount: 5448861, fuel_subsidy: 2695900 },
                    'í‰íƒ ë¯¸êµ°ìŠ¤ì¿¨': { total_kg: 515.26, charge_count: 36, avg_per_charge: 14.31, charging_amount: 5828601, fuel_subsidy: 2553750 },
                    'í• ë ë£¨ì•¼êµíšŒ': { total_kg: 486.54, charge_count: 29, avg_per_charge: 16.78, charging_amount: 5329280, fuel_subsidy: 2422400 },
                    'ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›': { total_kg: 397.07, charge_count: 19, avg_per_charge: 20.90, charging_amount: 4379510, fuel_subsidy: 1979950 },
                    'ê³ ëŒ€êµ¬ë¡œë³‘ì›': { total_kg: 308.36, charge_count: 18, avg_per_charge: 17.13, charging_amount: 3382280, fuel_subsidy: 1537400 },
                    'ë¡¯ë°ë©´ì„¸ì ': { total_kg: 274.07, charge_count: 14, avg_per_charge: 19.58, charging_amount: 3156612, fuel_subsidy: 1366500 },
                    'ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)': { total_kg: 195.21, charge_count: 10, avg_per_charge: 19.52, charging_amount: 2141480, fuel_subsidy: 973400 },
                    'DL E&C': { total_kg: 101.30, charge_count: 4, avg_per_charge: 25.32, charging_amount: 1135061, fuel_subsidy: 505550 },
                    'ìµœì„ ì–´í•™ì›(ì˜í†µ)': { total_kg: 93.00, charge_count: 8, avg_per_charge: 11.62, charging_amount: 1033638, fuel_subsidy: 453350 },
                    'ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)': { total_kg: 80.26, charge_count: 3, avg_per_charge: 26.75, charging_amount: 1210550, fuel_subsidy: 550250 }
                }
            },
            '2024-11': {
                summary: { total_kg: 21766.39, total_count: 1112, customer_count: 15, vehicle_count: 81 },
                // Note: í‰íƒë¯¸êµ°ìŠ¤ì¿¨ 11ì›” Excelì— ì°¨ëŸ‰ë²ˆí˜¸ ëˆ„ë½ - ì´ 81ëŒ€ ìœ ì§€ ìœ„í•´ 0ìœ¼ë¡œ ì²˜ë¦¬
                vehicles_by_customer: {
                    'ì‚¼ì„±ì „ì(ìˆ˜ì›)': 29, 'ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸': 15,
                    'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤': 10, 'ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)': 8,
                    'ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤': 5, 'ê²½ë³µì´ˆë“±í•™êµ': 4, 'í‰íƒë¯¸êµ°ìŠ¤ì¿¨': 0,
                    'ë¡¯ë°ë©´ì„¸ì ': 2, 'ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)': 2,
                    'ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›': 1, 'ê³ ëŒ€êµ¬ë¡œë³‘ì›': 1, 'ì‚¼ì„±ì „ì(í‰íƒ)': 1,
                    'ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)': 1, 'ìµœì„ ì–´í•™ì›(ì˜í†µ)': 1, 'í• ë ë£¨ì•¼êµíšŒ': 1
                },
                charging_stations: [
                    { name: 'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 8512.10, count: 34 },
                    { name: 'ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 3142.59, count: 8 },
                    { name: 'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 2955.76, count: 12 },
                    { name: 'ì—ìŠ¤ì¼€ì´ ì¸ì²œì‹ í¥ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 1769.10, count: 7 },
                    { name: 'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 1568.46, count: 7 },
                    { name: 'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 1392.34, count: 4 },
                    { name: 'í•˜ì´ë„· ì¸ì²œê³µí•­T1 ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 1143.63, count: 2 },
                    { name: 'ì—ìŠ¤ì¼€ì´ í‰íƒëª¨ê³¡ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 422.08, count: 3 },
                    { name: 'í•˜ì´ë„· ê´‘ëª…ì†Œí•˜ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 415.14, count: 2 },
                    { name: 'ì›”ê³¡ìˆ˜ì†Œì¶©ì „ì†Œ(ì£¼)', total_kg: 223.93, count: 1 },
                    { name: 'í•˜ì´ë„· ì—ë²„ëœë“œ ìˆ˜ì†Œì¶©ì „ì†Œ', total_kg: 221.26, count: 1 }
                ],
                companies: {
                    'ì˜¨ë²„ìŠ¤': {
                        total_kg: 18052.74,
                        color: '#3B82F6',
                        customers: 10,
                        vehicles: 71,
                        charge_count: 898,
                        daily_avg: 601.76,
                        charge_cycle: 2.37
                    },
                    'ì›ë”ì˜¨': {
                        total_kg: 2164.85,
                        color: '#10B981',
                        customers: 3,
                        vehicles: 8,
                        charge_count: 107,
                        daily_avg: 72.16,
                        charge_cycle: 2.24
                    },
                    'ì˜¨ëª¨': {
                        total_kg: 1548.80,
                        color: '#8B5CF6',
                        customers: 1,
                        vehicles: 2,
                        charge_count: 107,
                        daily_avg: 51.63,
                        charge_cycle: 0.56
                    }
                },
                customers: {
                    'ì‚¼ì„±ì „ì(ìˆ˜ì›)': { total_kg: 7953.07, charge_count: 405, avg_per_charge: 19.64 },
                    'ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸': { total_kg: 3006.66, charge_count: 145, avg_per_charge: 20.74 },
                    'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤': { total_kg: 2423.64, charge_count: 118, avg_per_charge: 20.54 },
                    'ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)': { total_kg: 1497.85, charge_count: 94, avg_per_charge: 15.93 },
                    'í‰íƒë¯¸êµ°ìŠ¤ì¿¨': { total_kg: 1436.25, charge_count: 82, avg_per_charge: 17.52 },
                    'ê²½ë³µì´ˆë“±í•™êµ': { total_kg: 1258.42, charge_count: 52, avg_per_charge: 24.20 },
                    'ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤': { total_kg: 1184.97, charge_count: 61, avg_per_charge: 19.43 },
                    'ì‚¼ì„±ì „ì(í‰íƒ)': { total_kg: 646.01, charge_count: 35, avg_per_charge: 18.46 },
                    'ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›': { total_kg: 569.63, charge_count: 25, avg_per_charge: 22.79 },
                    'í• ë ë£¨ì•¼êµíšŒ': { total_kg: 541.19, charge_count: 30, avg_per_charge: 18.04 },
                    'ê³ ëŒ€êµ¬ë¡œë³‘ì›': { total_kg: 415.14, charge_count: 20, avg_per_charge: 20.76 },
                    'ë¡¯ë°ë©´ì„¸ì ': { total_kg: 320.26, charge_count: 17, avg_per_charge: 18.84 },
                    'ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)': { total_kg: 245.56, charge_count: 16, avg_per_charge: 15.35 },
                    'ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)': { total_kg: 182.02, charge_count: 7, avg_per_charge: 26.00 },
                    'ìµœì„ ì–´í•™ì›(ì˜í†µ)': { total_kg: 85.72, charge_count: 5, avg_per_charge: 17.14 }
                }
            }
        };

        // ê±°ë˜ì²˜ë³„ ì¶©ì „ì†Œ ì´ìš©ëŸ‰ (ê°€ì¤‘í‰ê·  ê±°ë¦¬ ê³„ì‚°ìš©)
        const CUSTOMER_STATION_USAGE = {
            "2024-10": {
                "ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸": {"ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ": 1920.74, "í•˜ì´ë„· ì¸ì²œê³µí•­T1 ìˆ˜ì†Œì¶©ì „ì†Œ": 838.32},
                "ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)": {"í•˜ì´ë„· ì—ë²„ëœë“œ ìˆ˜ì†Œì¶©ì „ì†Œ": 907.17, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 159.31, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 96.33},
                "ì‚¼ì„±ë””ì§€í„¸ì‹œí‹°(ìˆ˜ì›)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 3245.22, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 464.47, "ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 864.18, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 1730.77, "í•˜ì´ë„· Hêµ­íšŒ ìˆ˜ì†Œì¶©ì „ì†Œ": 23.54},
                "ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤": {"ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ": 562.35, "ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 248.94, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 107.47, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 41.56},
                "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤": {"ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 1057.28, "ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ": 689.98, "ì¸ì²œê·¸ë¦° ìˆ˜ì†Œì¶©ì „ì†Œ": 187.38, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 218.53},
                "ë¡¯ë°ë©´ì„¸ì ": {"ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ": 273.3},
                "ê³ ëŒ€êµ¬ë¡œë³‘ì›": {"í•˜ì´ë„· ê´‘ëª…ì†Œí•˜ ìˆ˜ì†Œì¶©ì „ì†Œ": 307.48},
                "ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›": {"ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 59.05, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 212.96, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 123.98},
                "í• ë ë£¨ì•¼êµíšŒ": {"ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 340.95, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 143.53},
                "ìµœì„ ì–´í•™ì›(ì˜í†µ)": {"ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 90.67},
                "ì‚¼ì„±ì „ì(í‰íƒ)": {"ì—ìŠ¤ì¼€ì´ í‰íƒëª¨ê³¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 100.89, "ì›”ê³¡ìˆ˜ì†Œì¶©ì „ì†Œ(ì£¼)": 438.29},
                "ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)": {"ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 179.07, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 15.61},
                "ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)": {"ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 82.61, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 27.44},
                "í‰íƒ ë¯¸êµ°ìŠ¤ì¿¨": {"ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 310.79, "ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 84.63, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 90.66},
                "DL E&C": {"ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 25.39, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 75.72},
                "ê²½ë³µì´ˆë“±í•™êµ(2í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 82.78},
                "ê²½ë³µì´ˆë“±í•™êµ(3í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 98.06},
                "ê²½ë³µì´ˆë“±í•™êµ(4í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 92.98},
                "ê²½ë³µì´ˆë“±í•™êµ(5í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 38.06},
                "ê²½ë³µì´ˆë“±í•™êµ(6í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 107.11},
                "ê²½ë³µì´ˆë“±í•™êµ(7í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 76.06},
                "ê²½ë³µì´ˆë“±í•™êµ(8í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 66.71},
                "ê²½ë³µì´ˆë“±í•™êµ(9í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 79.34},
                "ê²½ë³µì´ˆë“±í•™êµ(10í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 43.5, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 23.14},
                "ê²½ë³µì´ˆë“±í•™êµ(12í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 50.08, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 18.22},
                "ê²½ë³µì´ˆë“±í•™êµ(13í˜¸)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 78.81}
            },
            "2024-11": {
                "ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸": {"ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ": 1990.04, "í•˜ì´ë„· ì¸ì²œê³µí•­T1 ìˆ˜ì†Œì¶©ì „ì†Œ": 1016.62},
                "ì‚¼ì„±ì „ì(ìˆ˜ì›)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 4189.38, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 833.82, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 1081.75, "ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 1830.56, "ì—ìŠ¤ì¼€ì´ ì›ì£¼ì¥ì–‘ ìˆ˜ì†Œì¶©ì „ì†Œ": 17.56},
                "ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)": {"í•˜ì´ë„· ì—ë²„ëœë“œ ìˆ˜ì†Œì¶©ì „ì†Œ": 1065.47, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 278.17, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 87.67, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 26.76, "ë•í‰íœ´ê²Œì†Œ(ê°•ë¦‰) ìˆ˜ì†Œì¶©ì „ì†Œ": 24.23, "ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 15.55},
                "ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤": {"ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ": 709.14, "ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 376.20, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 54.15, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 24.72, "ì¸ì²œê·¸ë¦° ìˆ˜ì†Œì¶©ì „ì†Œ": 20.76},
                "í‰íƒë¯¸êµ°ìŠ¤ì¿¨": {"ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 494.96, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 469.73, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 357.18, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 114.38},
                "ë¡¯ë°ë©´ì„¸ì ": {"ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ": 320.26},
                "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤": {"ì—ìŠ¤ì¼€ì´ ì¸ì²œì‹ í¥ ìˆ˜ì†Œì¶©ì „ì†Œ": 971.20, "ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ": 730.01, "ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ": 509.30, "ì¸ì²œê·¸ë¦° ìˆ˜ì†Œì¶©ì „ì†Œ": 173.96, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 27.08, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 12.09},
                "í• ë ë£¨ì•¼êµíšŒ": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 281.38, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 259.81},
                "ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)": {"ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 224.34, "ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 21.22},
                "ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 422.02, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 120.75, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 26.86},
                "ì‚¼ì„±ì „ì(í‰íƒ)": {"ì—ìŠ¤ì¼€ì´ í‰íƒëª¨ê³¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 362.94, "ì›”ê³¡ìˆ˜ì†Œì¶©ì „ì†Œ(ì£¼)": 283.07},
                "ê³ ëŒ€êµ¬ë¡œë³‘ì›": {"í•˜ì´ë„· ê´‘ëª…ì†Œí•˜ ìˆ˜ì†Œì¶©ì „ì†Œ": 415.14},
                "ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 156.54, "ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ": 25.48},
                "ê²½ë³µì´ˆë“±í•™êµ": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 1258.42},
                "ìµœì„ ì–´í•™ì›(ì˜í†µ)": {"ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ": 65.17, "ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ": 20.55}
            }
        };

        // ì‹œê°„ëŒ€ë³„ ì¶©ì „ í†µê³„ (íˆíŠ¸ë§µìš©)
        const CHARGING_HOURLY_STATS = {
            "2024-10": {"05": 2, "06": 30, "07": 22, "08": 100, "09": 186, "10": 153, "11": 109, "12": 37, "13": 61, "14": 45, "15": 60, "16": 42, "17": 35, "18": 46, "19": 33, "20": 13, "21": 2, "22": 1},
            "2024-11": {"05": 17, "06": 34, "07": 18, "08": 122, "09": 228, "10": 209, "11": 123, "12": 61, "13": 66, "14": 50, "15": 64, "16": 48, "17": 26, "18": 30, "19": 7, "20": 6, "21": 2, "22": 1}
        };

        // ì™¸ë¶€ ì¶©ì „ì†Œ ë„ë¡œê±°ë¦¬ (í¬ê³¡ ê¸°ì¤€) - Kakao Directions API ê³„ì‚° ê²°ê³¼
        // ê±°ë˜ì²˜ â†’ í¬ê³¡ ì¶©ì „ì†Œ ê±°ë¦¬ (Kakao API ê³„ì‚°)
        const CUSTOMER_TO_POGOK_DISTANCE = {
            'DL E&C': 51.3,
            'ê²½ë³µì´ˆë“±í•™êµ': 48.8,
            'ê³ ëŒ€êµ¬ë¡œë³‘ì›': 57.9,
            'ë¡¯ë°ë©´ì„¸ì ': 97.0,    // ì˜ì¢…ë„ ì„¬ - ìˆ˜ë™ ì„¤ì •
            'ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤': 59.8,
            'ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›': 17.0,
            'ì‚¼ì„±ë””ì§€í„¸ì‹œí‹°(ìˆ˜ì›)': 20.1,
            'ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)': 4.9,
            'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤': 60.1,
            'ì‚¼ì„±ì „ì(ìˆ˜ì›)': 20.1,
            'ì‚¼ì„±ì „ì(í‰íƒ)': 36.5,
            'ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸': 91.3,
            'ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)': 20.2,
            'ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)': 39.3,
            'ìµœì„ ì–´í•™ì›(ì˜í†µ)': 20.9,
            'í‰íƒ ë¯¸êµ°ìŠ¤ì¿¨': 42.0,  // ìˆ˜ë™ ì„¤ì •
            'í‰íƒë¯¸êµ°ìŠ¤ì¿¨': 42.0,   // ìˆ˜ë™ ì„¤ì •
            'í• ë ë£¨ì•¼êµíšŒ': 28.7
        };

        // ê±°ë˜ì²˜ â†’ ì™¸ë¶€ ì¶©ì „ì†Œ ê±°ë¦¬ (Kakao API ê³„ì‚°)
        const CUSTOMER_TO_STATION_DISTANCES = {
            'DL E&C': {
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 27.2,
                'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 45.5
            },
            'ê²½ë³µì´ˆë“±í•™êµ': {
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 20.6,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 18.7
            },
            'ê³ ëŒ€êµ¬ë¡œë³‘ì›': {
                'í•˜ì´ë„· ê´‘ëª…ì†Œí•˜ ìˆ˜ì†Œì¶©ì „ì†Œ': 10.3
            },
            'ë¡¯ë°ë©´ì„¸ì ': {
                'ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ': 40.0  // ì˜ì¢…ë„ - ìˆ˜ë™ ì„¤ì •
            },
            'ë¡¯ë°ë°”ì´ì˜¤ë¡œì§ìŠ¤': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 56.9,
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 49.4,
                'ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ': 24.1,
                'ì¸ì²œê·¸ë¦° ìˆ˜ì†Œì¶©ì „ì†Œ': 18.0,
                'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 27.0
            },
            'ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 20.2,
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 9.7,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 12.7
            },
            'ì‚¼ì„±ë””ì§€í„¸ì‹œí‹°(ìˆ˜ì›)': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 6.1,
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 27.1,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 30.2,
                'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 22.1,
                'í•˜ì´ë„· Hêµ­íšŒ ìˆ˜ì†Œì¶©ì „ì†Œ': 48.0
            },
            'ì‚¼ì„±ë¬¼ì‚°(ì—ë²„ëœë“œ)': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 25.9,
                'ë•í‰íœ´ê²Œì†Œ(ê°•ë¦‰) ìˆ˜ì†Œì¶©ì „ì†Œ': 34.1,
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 25.1,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 24.4,
                'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 40.1,
                'í•˜ì´ë„· ì—ë²„ëœë“œ ìˆ˜ì†Œì¶©ì „ì†Œ': 4.6
            },
            'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 57.2,
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 49.7,
                'ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ': 17.1,
                'ì—ìŠ¤ì¼€ì´ ì¸ì²œì‹ í¥ ìˆ˜ì†Œì¶©ì „ì†Œ': 12.1,
                'ì¸ì²œê·¸ë¦° ìˆ˜ì†Œì¶©ì „ì†Œ': 13.9,
                'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 27.3
            },
            'ì‚¼ì„±ì „ì(ìˆ˜ì›)': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 6.1,
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 27.4,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 30.4,
                'ì—ìŠ¤ì¼€ì´ ì›ì£¼ì¥ì–‘ ìˆ˜ì†Œì¶©ì „ì†Œ': 98.9,
                'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 22.1
            },
            'ì‚¼ì„±ì „ì(í‰íƒ)': {
                'ì—ìŠ¤ì¼€ì´ í‰íƒëª¨ê³¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 4.7,
                'ì›”ê³¡ìˆ˜ì†Œì¶©ì „ì†Œ(ì£¼)': 10.9
            },
            'ì¸ìŠ¤íŒŒì´ì–´ ì—”í„°í…Œì¸ë¨¼íŠ¸ ë¦¬ì¡°íŠ¸': {
                'ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ': 37.8,
                'í•˜ì´ë„· ì¸ì²œê³µí•­T1 ìˆ˜ì†Œì¶©ì „ì†Œ': 10.0  // ì˜ì¢…ë„ - ìˆ˜ë™ ì„¤ì •
            },
            'ì²­ë‹´ì–´í•™ì›(ë¶„ë‹¹)': {
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 5.4,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 10.1
            },
            'ì²­ë‹´ì–´í•™ì›(ì†¡íŒŒ)': {
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 15.9,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 13.9
            },
            'ìµœì„ ì–´í•™ì›(ì˜í†µ)': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 6.2,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 28.8
            },
            'í‰íƒ ë¯¸êµ°ìŠ¤ì¿¨': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 38.0,  // ìˆ˜ë™ ì„¤ì •
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 55.0,  // ìˆ˜ë™ ì„¤ì •
                'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 45.0   // ìˆ˜ë™ ì„¤ì •
            },
            'í‰íƒë¯¸êµ°ìŠ¤ì¿¨': {
                'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 38.0,
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 50.0,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 55.0,
                'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 45.0
            },
            'í• ë ë£¨ì•¼êµíšŒ': {
                'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 4.5,
                'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 6.2
            }
        };

        // í¬ê³¡ â†’ ì™¸ë¶€ ì¶©ì „ì†Œ ê±°ë¦¬ (ê¸°ì¡´ í˜¸í™˜ìš©)
        const EXTERNAL_STATION_DISTANCES = {
            'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 25.8,
            'ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ': 64.7,
            'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ': 40.5,
            'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ': 26.6,
            'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ': 25.0,
            'í•˜ì´ë„· ì—ë²„ëœë“œ ìˆ˜ì†Œì¶©ì „ì†Œ': 5.2,
            'í•˜ì´ë„· ì¸ì²œê³µí•­T1 ìˆ˜ì†Œì¶©ì „ì†Œ': 87.0,
            'ì—ìŠ¤ì¼€ì´ ì¸ì²œì‹ í¥ ìˆ˜ì†Œì¶©ì „ì†Œ': 61.8,
            'í•˜ì´ë„· ê´‘ëª…ì†Œí•˜ ìˆ˜ì†Œì¶©ì „ì†Œ': 46.9,
            'ì—ìŠ¤ì¼€ì´ í‰íƒëª¨ê³¡ ìˆ˜ì†Œì¶©ì „ì†Œ': 35.3,
            'ì›”ê³¡ìˆ˜ì†Œì¶©ì „ì†Œ(ì£¼)': 35.8,
            'ì¸ì²œê·¸ë¦° ìˆ˜ì†Œì¶©ì „ì†Œ': 67.8,
            'ë•í‰íœ´ê²Œì†Œ(ê°•ë¦‰) ìˆ˜ì†Œì¶©ì „ì†Œ': 31.1,
            'ì—ìŠ¤ì¼€ì´ ì›ì£¼ì¥ì–‘ ìˆ˜ì†Œì¶©ì „ì†Œ': 82.9,
            'í•˜ì´ë„· Hêµ­íšŒ ìˆ˜ì†Œì¶©ì „ì†Œ': 52.8
        };

        // ê±°ë˜ì²˜ì—ì„œ ê¸°ì¡´ ì¶©ì „ì†Œê¹Œì§€ì˜ ê°€ì¤‘í‰ê·  ê±°ë¦¬ ê³„ì‚° (ê±°ë˜ì²˜â†’ì¶©ì „ì†Œ)
        function calculateWeightedAvgDistance(customerName, month) {
            const normalizedName = normalizeName(customerName);
            const monthData = CUSTOMER_STATION_USAGE[month] || {};

            // ê±°ë˜ì²˜ë³„ ê±°ë¦¬ ë°ì´í„° ì¡°íšŒ
            let customerDistances = CUSTOMER_TO_STATION_DISTANCES[customerName]
                                 || CUSTOMER_TO_STATION_DISTANCES[normalizedName];

            // ê²½ë³µì´ˆë“±í•™êµ ë“± í•©ì‚° ì¼€ì´ìŠ¤
            if (!customerDistances) {
                for (const key of Object.keys(CUSTOMER_TO_STATION_DISTANCES)) {
                    if (customerName.startsWith(key) || normalizedName.startsWith(key) ||
                        key.startsWith(customerName) || key.startsWith(normalizedName)) {
                        customerDistances = CUSTOMER_TO_STATION_DISTANCES[key];
                        break;
                    }
                }
            }

            // ì •í™•í•œ ì´ë¦„ ë§¤ì¹­ ì‹œë„
            let usage = monthData[customerName] || monthData[normalizedName];

            // ì •í™•í•œ ë§¤ì¹­ì´ ì—†ìœ¼ë©´, ë¶€ë¶„ ë§¤ì¹­ìœ¼ë¡œ í•©ì‚° (ê²½ë³µì´ˆë“±í•™êµ(Xí˜¸) ë“±)
            if (!usage) {
                usage = {};
                for (const [name, stationData] of Object.entries(monthData)) {
                    // "ê²½ë³µì´ˆë“±í•™êµ(2í˜¸)" -> "ê²½ë³µì´ˆë“±í•™êµ"ë¡œ ì‹œì‘í•˜ëŠ”ì§€ ì²´í¬
                    if (name.startsWith(customerName) || name.startsWith(normalizedName)) {
                        for (const [station, kg] of Object.entries(stationData)) {
                            usage[station] = (usage[station] || 0) + kg;
                        }
                    }
                }
            }

            let totalKg = 0;
            let weightedSum = 0;

            for (const [station, kg] of Object.entries(usage)) {
                // ê±°ë˜ì²˜â†’ì¶©ì „ì†Œ ê±°ë¦¬ ì‚¬ìš© (ì—†ìœ¼ë©´ null)
                const distance = customerDistances?.[station];
                if (distance !== undefined && distance !== null) {
                    weightedSum += distance * kg;
                    totalKg += kg;
                }
            }

            return totalKg > 0 ? weightedSum / totalKg : null;
        }

        // ê±°ë˜ì²˜ë³„ ì¶©ì „ì†Œ ì´ìš©ëŸ‰ ì¡°íšŒ (íˆ´íŒìš©)
        function getCustomerStationUsage(customerName, month) {
            const normalizedName = normalizeName(customerName);
            const monthData = CUSTOMER_STATION_USAGE[month] || {};

            // ì •í™•í•œ ì´ë¦„ ë§¤ì¹­ ì‹œë„
            let usage = monthData[customerName] || monthData[normalizedName];

            // ì •í™•í•œ ë§¤ì¹­ì´ ì—†ìœ¼ë©´, ë¶€ë¶„ ë§¤ì¹­ìœ¼ë¡œ í•©ì‚° (ê²½ë³µì´ˆë“±í•™êµ(Xí˜¸) ë“±)
            if (!usage) {
                usage = {};
                for (const [name, stationData] of Object.entries(monthData)) {
                    if (name.startsWith(customerName) || name.startsWith(normalizedName)) {
                        for (const [station, kg] of Object.entries(stationData)) {
                            usage[station] = (usage[station] || 0) + kg;
                        }
                    }
                }
            }

            return Object.keys(usage).length > 0 ? usage : null;
        }

        // íˆ´íŒ í‘œì‹œ
        function showStationTooltip(event, customerName, month) {
            const tooltip = document.getElementById('stationTooltip');
            const usage = getCustomerStationUsage(customerName, month);
            const normalizedName = normalizeName(customerName);

            // ê±°ë˜ì²˜ë³„ ê±°ë¦¬ ë°ì´í„° ì¡°íšŒ
            let customerDistances = CUSTOMER_TO_STATION_DISTANCES[customerName]
                                 || CUSTOMER_TO_STATION_DISTANCES[normalizedName];
            if (!customerDistances) {
                for (const key of Object.keys(CUSTOMER_TO_STATION_DISTANCES)) {
                    if (customerName.startsWith(key) || normalizedName.startsWith(key) ||
                        key.startsWith(customerName) || key.startsWith(normalizedName)) {
                        customerDistances = CUSTOMER_TO_STATION_DISTANCES[key];
                        break;
                    }
                }
            }

            // í¬ê³¡ ê±°ë¦¬ ì¡°íšŒ
            const pogokDistance = CUSTOMER_TO_POGOK_DISTANCE[customerName]
                               || CUSTOMER_TO_POGOK_DISTANCE[normalizedName]
                               || (() => {
                                   for (const key of Object.keys(CUSTOMER_TO_POGOK_DISTANCE)) {
                                       if (customerName.startsWith(key) || key.startsWith(customerName)) {
                                           return CUSTOMER_TO_POGOK_DISTANCE[key];
                                       }
                                   }
                                   return null;
                               })();

            if (!usage) {
                tooltip.innerHTML = `<h4>ğŸšŒ ${customerName}</h4><p class="no-data">ì¶©ì „ì†Œ ì´ìš© ë°ì´í„° ì—†ìŒ</p>`;
            } else {
                // ì¶©ì „ëŸ‰ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ê°€ì¥ ë§ì´ ì¶©ì „í•œ ì¶©ì „ì†Œê°€ ìƒë‹¨)
                const sortedUsage = Object.entries(usage).sort((a, b) => b[1] - a[1]);

                let html = `<h4>ğŸšŒ ${customerName}</h4>`;
                if (pogokDistance) {
                    html += `<div class="pogok-distance">í¬ê³¡ ì¶©ì „ì†Œê¹Œì§€: <strong>${pogokDistance} km</strong></div>`;
                }
                html += '<table><thead><tr><th>No.</th><th>ê¸°ì¡´ ì´ìš© ì¶©ì „ì†Œ</th><th class="text-right">ì¶©ì „ëŸ‰</th><th class="text-right">ê±°ë¦¬</th></tr></thead><tbody>';

                sortedUsage.forEach(([station, kg], idx) => {
                    // ê±°ë˜ì²˜â†’ì¶©ì „ì†Œ ê±°ë¦¬ ì‚¬ìš©
                    const distance = customerDistances?.[station];
                    const distanceStr = distance !== undefined ? `${distance} km` : '-';
                    const stationShort = station.replace(' ìˆ˜ì†Œì¶©ì „ì†Œ', '').replace('ìˆ˜ì†Œì¶©ì „ì†Œ', '');
                    html += `<tr>
                        <td class="text-center text-gray-400">${idx + 1}</td>
                        <td>${stationShort}</td>
                        <td class="text-right kg-value">${kg.toFixed(1)} kg</td>
                        <td class="text-right km-value">${distanceStr}</td>
                    </tr>`;
                });
                html += '</tbody></table>';
                tooltip.innerHTML = html;
            }

            // íˆ´íŒ ìœ„ì¹˜ ê³„ì‚° - í–‰ ë°”ë¡œ ìœ„ì— í‘œì‹œ
            const rect = event.target.closest('tr').getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            const tooltipWidth = 340;
            const tooltipHeight = tooltip.offsetHeight || 180;

            // í–‰ì˜ ì¤‘ì•™ ìœ„ìª½ì— í‘œì‹œ
            let left = rect.left + (rect.width / 2) - (tooltipWidth / 2);
            let top = rect.top - tooltipHeight - 8;

            // ì™¼ìª½ ê²½ê³„ ì²´í¬
            if (left < 10) {
                left = 10;
            }
            // ì˜¤ë¥¸ìª½ ê²½ê³„ ì²´í¬
            if (left + tooltipWidth > window.innerWidth - 10) {
                left = window.innerWidth - tooltipWidth - 10;
            }
            // ìœ„ìª½ ê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ì•„ë˜ìª½ì— í‘œì‹œ
            if (top < 80) {
                top = rect.bottom + 8;
            }
            // ì•„ë˜ìª½ ê²½ê³„ ì²´í¬
            if (top + tooltipHeight > window.innerHeight - 10) {
                top = window.innerHeight - tooltipHeight - 10;
            }

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.classList.add('visible');
        }

        // íˆ´íŒ ìˆ¨ê¸°ê¸°
        function hideStationTooltip() {
            document.getElementById('stationTooltip').classList.remove('visible');
        }

        // ê±°ë˜ì²˜ëª… ì •ê·œí™” (10ì›”ê³¼ 11ì›” ëª…ì¹­ ì°¨ì´ í•´ê²°)
        const NAME_ALIASES = {
            'ì‚¼ì„±ë””ì§€í„¸ì‹œí‹°(ìˆ˜ì›)': 'ì‚¼ì„±ì „ì(ìˆ˜ì›)',
            'í‰íƒ ë¯¸êµ°ìŠ¤ì¿¨': 'í‰íƒë¯¸êµ°ìŠ¤ì¿¨'
        };

        function normalizeName(name) {
            return NAME_ALIASES[name] || name;
        }

        // í˜„ì¬ ì›”ì˜ ê³ ê° ë°ì´í„°ë¥¼ CUSTOMERS í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        function getCustomersForMonth(month) {
            const monthData = MONTHLY_DATA[month];
            if (!monthData) return [];

            const prevMonth = month === '2024-11' ? '2024-10' : null;
            const prevData = prevMonth ? MONTHLY_DATA[prevMonth] : null;

            return Object.entries(monthData.customers).map(([name, data]) => {
                const normalizedName = normalizeName(name);
                const info = CUSTOMER_INFO[name] || CUSTOMER_INFO[normalizedName] || {};

                // ì „ì›” ë°ì´í„° ì°¾ê¸°
                let prevCustomer = null;
                if (prevData) {
                    for (const [prevName, prevCust] of Object.entries(prevData.customers)) {
                        if (normalizeName(prevName) === normalizedName) {
                            prevCustomer = prevCust;
                            break;
                        }
                    }
                }

                const change_kg = prevCustomer ? data.total_kg - prevCustomer.total_kg : null;
                const change_pct = prevCustomer && prevCustomer.total_kg > 0
                    ? ((data.total_kg - prevCustomer.total_kg) / prevCustomer.total_kg * 100)
                    : null;

                return {
                    name: normalizedName,
                    displayName: name,
                    lat: info.lat || 0,
                    lng: info.lng || 0,
                    h2_buses: monthData.vehicles_by_customer?.[name] ?? monthData.vehicles_by_customer?.[normalizedName] ?? info.h2_buses ?? 1,
                    road_distance_km: info.road_distance_km || 0,
                    road_time_min: info.road_time_min || 0,
                    total_kg: data.total_kg,
                    charge_count: data.charge_count,
                    avg_per_charge: data.avg_per_charge,
                    daily_avg: data.total_kg / 30,
                    prev_kg: prevCustomer ? prevCustomer.total_kg : null,
                    change_kg: change_kg,
                    change_pct: change_pct,
                    isNew: prevCustomer === null && prevData !== null,
                    subsidy: data.fuel_subsidy ?? Math.round(data.total_kg * 5000),
                    cost_vat: data.charging_amount ?? Math.round(data.total_kg * 11000 * 1.1),
                    price_per_kg: 11000
                };
            }).sort((a, b) => b.total_kg - a.total_kg);
        }

        // ì´íƒˆ ê³ ê° ì°¾ê¸°
        function getChurnedCustomers(currentMonth) {
            if (currentMonth === '2024-10') return [];

            const prevMonth = '2024-10';
            const currentData = MONTHLY_DATA[currentMonth];
            const prevData = MONTHLY_DATA[prevMonth];

            const currentNames = new Set(Object.keys(currentData.customers).map(normalizeName));

            return Object.entries(prevData.customers)
                .filter(([name]) => !currentNames.has(normalizeName(name)))
                .map(([name, data]) => ({
                    name: normalizeName(name),
                    displayName: name,
                    prev_kg: data.total_kg,
                    change_kg: -data.total_kg,
                    change_pct: -100,
                    isChurned: true
                }));
        }

        // í˜„ì¬ ì›” ë°ì´í„°ë¡œ CUSTOMERS ì´ˆê¸°í™”
        let CUSTOMERS = getCustomersForMonth(currentMonth);

        // ========== ì›” ì „í™˜ í•¨ìˆ˜ ==========
        function switchMonth(month) {
            currentMonth = month;
            CUSTOMERS = getCustomersForMonth(month);

            // 1. íƒ­ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.month-tab').forEach(tab => {
                if (tab.id === `month-tab-${month}`) {
                    tab.className = 'month-tab px-4 py-1.5 rounded-md text-sm font-medium transition-all bg-white text-blue-600';
                } else {
                    tab.className = 'month-tab px-4 py-1.5 rounded-md text-sm font-medium transition-all text-blue-200 hover:bg-blue-700/50';
                }
            });

            // 2. ì›” í‘œì‹œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const monthLabel = month === '2024-10' ? '10ì›”' : '11ì›”';
            const monthYearLabel = month === '2024-10' ? '2024ë…„ 10ì›”' : '2024ë…„ 11ì›”';
            document.getElementById('currentMonthDisplay').textContent = monthYearLabel;
            document.getElementById('monthHeaderLabel').textContent = monthLabel;

            // 3. ì „ì›”ëŒ€ë¹„ ì»¬ëŸ¼ í—¤ë” í‘œì‹œ/ìˆ¨ê¹€
            const hasComparison = month === '2024-11';
            document.querySelectorAll('[data-sort="change_kg"], [data-sort="change_pct"]').forEach(th => {
                th.style.display = hasComparison ? '' : 'none';
            });

            // 4. ìš”ì•½ í†µê³„ ì—…ë°ì´íŠ¸
            updateSummaryStats(month);

            // 5. í…Œì´ë¸”/ì°¨íŠ¸ ì¬ë Œë”ë§
            initTables();
            const topN = parseInt(document.getElementById('topNSelector')?.value || 10);
            updateCustomerChart(topN);

            // 6. ì‹œë®¬ë ˆì´ì…˜ ì¬ê³„ì‚° (í˜„ì¬ ë°˜ê²½ ê¸°ì¤€)
            const currentRadius = parseInt(document.getElementById('radiusSlider')?.value || 30);
            updateSimulation(currentRadius);

            // 7. ë²•ì¸ë³„ ì¶©ì „ëŸ‰ í—¤ë” ë° ì°¨íŠ¸/í…Œì´ë¸” ì—…ë°ì´íŠ¸
            const companyChartTitle = document.getElementById('companyChartTitle');
            if (companyChartTitle) {
                companyChartTitle.textContent = `ë²•ì¸ë³„ ì¶©ì „ëŸ‰ (${monthLabel})`;
            }
            updateCompanyChartByMonth();
            renderCompanyDetailTable();

            // 8. ê±°ë˜ì²˜ í…Œì´ë¸” ì„¤ëª… ì—…ë°ì´íŠ¸
            const customerDesc = document.getElementById('customerTableDescription');
            if (customerDesc) {
                customerDesc.innerHTML = `2025ë…„ ${monthLabel} ê¸°ì¤€ ìˆ˜ì†Œë²„ìŠ¤ ìš´í–‰ ê±°ë˜ì²˜ | ì¶©ì „ê¸ˆì•¡Â·1kgë‹¨ê°€ëŠ” <strong>ë¶€ê°€ì„¸ í¬í•¨</strong>`;
            }

            // 9. ìˆ˜ì†Œë²„ìŠ¤ í•©ê³„ ì—…ë°ì´íŠ¸
            const totalH2Buses = document.getElementById('totalH2BusesDisplay');
            if (totalH2Buses) {
                const data = MONTHLY_DATA[month];
                totalH2Buses.innerHTML = `${data.summary.vehicle_count}<span class="text-sm">ëŒ€</span>`;
            }

            // 10. í‘¸í„° ì—…ë°ì´íŠ¸
            const footerLabel = document.getElementById('footerDataLabel');
            if (footerLabel) {
                footerLabel.textContent = `ì›ë”ì—ë„ˆì§€ ìˆ˜ì†Œì¶©ì „ì†Œ ì‹œë®¬ë ˆì´ì…˜ ëŒ€ì‹œë³´ë“œ v5.1 | ë°ì´í„° ê¸°ì¤€: 2025ë…„ ${monthLabel}`;
            }
        }

        // ìš”ì•½ í†µê³„ ì—…ë°ì´íŠ¸
        function updateSummaryStats(month) {
            const data = MONTHLY_DATA[month];
            const prevMonth = month === '2024-11' ? '2024-10' : null;
            const prevData = prevMonth ? MONTHLY_DATA[prevMonth] : null;
            const monthLabel = month === '2024-10' ? '10ì›”' : '11ì›”';

            // 1. ìˆ˜ì†Œë²„ìŠ¤ ëŒ€ìˆ˜ ì¹´ë“œ (ì²« ë²ˆì§¸ ì¹´ë“œ)
            const vehicleCountEl = document.getElementById('vehicleCountDisplay');
            if (vehicleCountEl) {
                let html = `${data.summary.vehicle_count}`;
                if (prevData) {
                    const diff = data.summary.vehicle_count - prevData.summary.vehicle_count;
                    if (diff !== 0) {
                        const color = diff > 0 ? 'text-green-300' : 'text-red-300';
                        const arrow = diff > 0 ? 'â–²' : 'â–¼';
                        html += `<span class="${color} text-sm ml-2">${arrow}${Math.abs(diff)}</span>`;
                    }
                }
                html += `<span class="text-sm ml-1">ëŒ€</span>`;
                vehicleCountEl.innerHTML = html;
            }

            // 2. ê±°ë˜ì²˜ ìˆ˜ ë¼ë²¨ (ì²« ë²ˆì§¸ ì¹´ë“œ í•˜ë‹¨)
            const customerLabelEl = document.getElementById('customerCountLabel');
            if (customerLabelEl) {
                let text = `ê±°ë˜ì²˜ ${data.summary.customer_count}ê°œ`;
                if (prevData) {
                    const diff = data.summary.customer_count - prevData.summary.customer_count;
                    if (diff !== 0) {
                        const arrow = diff > 0 ? 'â–²' : 'â–¼';
                        text += ` (${arrow}${Math.abs(diff)})`;
                    }
                }
                customerLabelEl.textContent = text;
            }

            // 3. ì›” ì¶©ì „ëŸ‰ ì¹´ë“œ ë¼ë²¨
            const chargeLabelEl = document.getElementById('chargeCardLabel');
            if (chargeLabelEl) {
                chargeLabelEl.textContent = `${monthLabel} ì›ë” ì „ì²´ ì¶©ì „ëŸ‰`;
            }

            // 4. ì›” ì¶©ì „ëŸ‰ ìˆ˜ì¹˜
            const chargeEl = document.getElementById('monthlyChargeDisplay');
            if (chargeEl) {
                chargeEl.innerHTML = `${Math.round(data.summary.total_kg).toLocaleString()}<span class="text-sm ml-1">kg</span>`;
            }

            // 5. ì›” ì¶©ì „ëŸ‰ ì „ì›” ëŒ€ë¹„
            const changeEl = document.getElementById('chargeChangeDisplay');
            if (changeEl) {
                if (prevData) {
                    const diff = data.summary.total_kg - prevData.summary.total_kg;
                    const pct = (diff / prevData.summary.total_kg * 100).toFixed(1);
                    const sign = diff > 0 ? '+' : '';
                    changeEl.textContent = `ì „ì›” ëŒ€ë¹„ ${sign}${Math.round(diff).toLocaleString()}kg (${sign}${pct}%)`;
                    changeEl.style.display = '';
                } else {
                    changeEl.style.display = 'none';
                }
            }

            // 6. ì¶©ì „ì†Œ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì›”ë³„)
            updateChargingStationTable(month);
        }

        const CHARGING_STATIONS = [
            { name: 'ì—ìŠ¤ì¼€ì´ ì„±ë‚¨ì‚¬ì†¡ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.414814, lng: 127.115619, total_kg: 6951.53, count: 329, price_per_kg: 11000, road_distance_km: 26.7, road_time_min: 37, subsidy: 34757650 },
            { name: 'ì„¸ìš´ì‚°ì—…(ì£¼)ê°€ì¢Œ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.492005, lng: 126.650939, total_kg: 3528.74, count: 168, price_per_kg: 11550, road_distance_km: 68.5, road_time_min: 92, subsidy: 17643700 },
            { name: 'ì½”í•˜ì´ì   ì•ˆì‚°ë³¸ì˜¤ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.289790, lng: 126.872924, total_kg: 3447.28, count: 159, price_per_kg: 11900, road_distance_km: 40.6, road_time_min: 44, subsidy: 17236400 },
            { name: 'ì„±ë‚¨ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.421758, lng: 127.155178, total_kg: 2185.91, count: 120, price_per_kg: 11000, road_distance_km: 24.7, road_time_min: 34, subsidy: 10929550 },
            { name: 'ê¸°í¥íœ´ê²Œì†Œ(ë¶€ì‚°) ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.233563, lng: 127.105789, total_kg: 1301.98, count: 95, price_per_kg: 11400, road_distance_km: 20.2, road_time_min: 29, subsidy: 6509900 },
            { name: 'í•˜ì´ë„· ì—ë²„ëœë“œ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.293399, lng: 127.222755, total_kg: 1065.47, count: 68, price_per_kg: 11000, road_distance_km: 2.6, road_time_min: 7, subsidy: 5327350 },
            { name: 'í•˜ì´ë„· ì¸ì²œê³µí•­T1 ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.481639, lng: 126.423174, total_kg: 1016.62, count: 54, price_per_kg: 11000, road_distance_km: 87.0, road_time_min: 81, subsidy: 5083100 },
            { name: 'ì—ìŠ¤ì¼€ì´ ì¸ì²œì‹ í¥ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.436280, lng: 126.623811, total_kg: 971.20, count: 48, price_per_kg: 11000, road_distance_km: 64.0, road_time_min: 76, subsidy: 4856000 },
            { name: 'í•˜ì´ë„· ê´‘ëª…ì†Œí•˜ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.438555, lng: 126.892585, total_kg: 415.14, count: 20, price_per_kg: 11000, road_distance_km: 47.5, road_time_min: 50, subsidy: 2075700 },
            { name: 'ì—ìŠ¤ì¼€ì´ í‰íƒëª¨ê³¡ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.053813, lng: 127.080491, total_kg: 362.94, count: 21, price_per_kg: 11000, road_distance_km: 35.5, road_time_min: 55, subsidy: 1814700 },
            { name: 'ì›”ê³¡ìˆ˜ì†Œì¶©ì „ì†Œ(ì£¼)', lat: 35.143749, lng: 126.816904, total_kg: 283.07, count: 14, price_per_kg: 9900, road_distance_km: 269.8, road_time_min: 195, subsidy: 1415350 },
            { name: 'ì¸ì²œê·¸ë¦° ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.438660, lng: 126.620014, total_kg: 194.72, count: 13, price_per_kg: 9900, road_distance_km: 68.7, road_time_min: 75, subsidy: 973600 },
            { name: 'ë•í‰íœ´ê²Œì†Œ(ê°•ë¦‰) ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.242839, lng: 127.391004, total_kg: 24.23, count: 2, price_per_kg: 10950, road_distance_km: 27.4, road_time_min: 38, subsidy: 121100 },
            { name: 'ì—ìŠ¤ì¼€ì´ ì›ì£¼ì¥ì–‘ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.420459, lng: 127.964931, total_kg: 17.56, count: 1, price_per_kg: 11000, road_distance_km: 86.1, road_time_min: 76, subsidy: 87800 },
            { name: 'í•˜ì´ë„· Hêµ­íšŒ ìˆ˜ì†Œì¶©ì „ì†Œ', lat: 37.530125, lng: 126.914625, total_kg: 280.61, count: 1, price_per_kg: 11000, road_distance_km: 52.3, road_time_min: 65, subsidy: 1403050 }
        ];

        // ì¶©ì „ì†Œ ê¸°ë³¸ ì •ë³´ (ìœ„ì¹˜, ê°€ê²© ë“± - ê³ ì •)
        const CHARGING_STATION_INFO = Object.fromEntries(
            CHARGING_STATIONS.map(s => [s.name, s])
        );

        // ì›”ë³„ ì¶©ì „ì†Œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getChargingStationsForMonth(month) {
            const monthData = MONTHLY_DATA[month];
            if (!monthData || !monthData.charging_stations) return CHARGING_STATIONS;

            return monthData.charging_stations.map(ms => {
                const baseInfo = CHARGING_STATION_INFO[ms.name] || {};
                return {
                    ...baseInfo,
                    name: ms.name,
                    total_kg: ms.total_kg,
                    count: ms.count,
                    subsidy: ms.total_kg * 5000  // ë³´ì¡°ê¸ˆ ì¬ê³„ì‚°
                };
            }).filter(s => s.total_kg > 0);
        }

        // ì¶©ì „ì†Œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateChargingStationTable(month) {
            const currentRadius = parseInt(document.getElementById('radiusSlider')?.value || 30);
            const stations = getChargingStationsForMonth(month);
            const totalCharge = stations.reduce((sum, s) => sum + s.total_kg, 0);
            const monthLabel = month === '2024-10' ? '10ì›”' : '11ì›”';

            const stationRows = stations
                .sort((a, b) => b.total_kg - a.total_kg)
                .map((s, idx) => {
                    const share = ((s.total_kg / totalCharge) * 100).toFixed(1);
                    const dailyKg = (s.total_kg / 30).toFixed(1);
                    const dailyVisits = Math.round(s.count / 30);
                    const monthlyAmount = s.price_per_kg ? (s.total_kg * s.price_per_kg).toLocaleString() : '-';
                    const straightDist = s.lat ? getDistanceFromStation(s.lat, s.lng) : 999;
                    const inRadius = straightDist <= currentRadius;
                    const distClass = inRadius ? 'bg-green-200 text-green-800 font-bold' : 'bg-gray-100 text-gray-600';
                    return `
                        <tr class="border-b hover:bg-green-50 data-list-item ${inRadius ? 'bg-green-50' : ''}">
                            <td class="px-2 py-2 text-center text-gray-400 text-xs">${idx + 1}</td>
                            <td class="px-4 py-2 font-medium">${s.name.replace(' ìˆ˜ì†Œì¶©ì „ì†Œ', '')}</td>
                            <td class="px-3 py-2 text-right font-medium text-green-600">${s.total_kg.toLocaleString()} kg</td>
                            <td class="px-3 py-2 text-right text-gray-500">${dailyKg} kg</td>
                            <td class="px-3 py-2 text-right text-gray-500">${s.count}íšŒ</td>
                            <td class="px-3 py-2 text-right text-gray-500">${dailyVisits}ëŒ€</td>
                            <td class="px-3 py-2 text-right text-blue-600 font-medium">${s.price_per_kg?.toLocaleString() || '-'}ì›</td>
                            <td class="px-3 py-2 text-right text-amber-600 text-xs">${monthlyAmount}ì›</td>
                            <td class="px-3 py-2 text-right text-green-600 text-xs">${s.subsidy?.toLocaleString() || '-'}ì›</td>
                            <td class="px-3 py-2 text-right">
                                <span class="${distClass} px-2 py-0.5 rounded text-xs">${s.road_distance_km?.toFixed(1) || '-'} km</span>
                                <span class="text-gray-400 text-xs ml-1">(${s.road_time_min || '-'}ë¶„)</span>
                            </td>
                            <td class="px-3 py-2 text-right">
                                <div class="flex items-center justify-end gap-2">
                                    <div class="w-12 h-2 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-full bg-green-500 rounded-full" style="width:${Math.min(share * 3, 100)}%"></div>
                                    </div>
                                    <span class="text-xs text-gray-600 w-10">${share}%</span>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

            document.getElementById('stationTable').innerHTML = stationRows;
            document.getElementById('stationTabCount').textContent = stations.length;
        }

        // ë²„ìŠ¤ ì°¨ê³ ì§€ ë°ì´í„° (Kakao API ì§€ì˜¤ì½”ë”© ê²°ê³¼)
        const BUS_DEPOTS = [
            { name: "ìš©ì¸ì‹œë‚´ì˜ì—…ì†Œ", address: "ìš©ì¸ì‹œ ì²˜ì¸êµ¬ í¬ê³¡ì ë§ˆì„±ë¦¬ 249", company: "KDìš´ì†¡ê·¸ë£¹", type: "city_bus", h2_buses: 0, lat: 37.2782, lng: 127.1905, road_distance_km: 4.5, road_time_min: 13, notes: "í¬ê³¡ ì¶©ì „ì†Œ ì¸ì ‘" },
            { name: "ê´‘ì£¼ì˜ì—…ì†Œ", address: "ê²½ê¸°ë„ ê´‘ì£¼ì‹œ ì˜¤í¬ì•ˆë¡œ 346", company: "ê²½ê¸°ê³ ì†/ëŒ€ì›ê³ ì†", type: "city_bus", h2_buses: 0, lat: 37.3656, lng: 127.2206, road_distance_km: 14.0, road_time_min: 26, notes: "CNG, EV ì¶©ì „ì†Œ ë³´ìœ " },
            { name: "ì‹ ê°ˆì˜ì—…ì†Œ", address: "ìš©ì¸ì‹œ ê¸°í¥êµ¬ ê¸°ê³¡ë¡œ 20", company: "ìš©ë‚¨ê³ ì†", type: "express_bus", h2_buses: 0, lat: 37.2532, lng: 127.0992, road_distance_km: 18.5, road_time_min: 34, notes: "ê´‘ì—­ë²„ìŠ¤ ìš´í–‰" },
            { name: "ë™íƒ„ì°¨ê³ ì§€", address: "ê²½ê¸°ë„ í™”ì„±ì‹œ 10ìš©ì‚¬ë¡œ 636", company: "KDìš´ì†¡ê·¸ë£¹", type: "city_bus", h2_buses: 0, lat: 37.1854, lng: 127.0800, road_distance_km: 20.2, road_time_min: 31, notes: "" },
            { name: "ì´ì²œì˜ì—…ì†Œ", address: "ê²½ê¸°ë„ ì´ì²œì‹œ ì´ì„­ëŒ€ì²œë¡œ 981-42", company: "ì´ì²œì‹œë‚´ë²„ìŠ¤", type: "city_bus", h2_buses: 7, lat: 37.2592, lng: 127.4430, road_distance_km: 31.6, road_time_min: 39, notes: "111ë²ˆ ë…¸ì„  ìˆ˜ì†Œë²„ìŠ¤ 7ëŒ€ ìš´í–‰" }
        ];

        // ì¿ íŒ¡ FC ë°ì´í„° (ë„ë¡œê±°ë¦¬ ê¸°ì¤€) - ì ì¬ê³ ê°
        // 30km ì´ë‚´: 16ê°œ, 50km ì´ë‚´: 28ê°œ
        const COUPANG_FC = [
            { code: "KKW3", name: "ì¿ íŒ¡ ê´‘êµ3ì„¼í„°", lat: 37.348, lng: 127.196, kakao_km: 12.4, kakao_min: 24, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "KKW5", name: "ì¿ íŒ¡ ê´‘êµ5ì„¼í„°", lat: 37.349, lng: 127.198, kakao_km: 12.6, kakao_min: 25, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "18:20", night: null } },
            { code: "YAN3", name: "ì¿ íŒ¡ ì–‘ì§€3ì„¼í„°", lat: 37.239, lng: 127.297, kakao_km: 14.6, kakao_min: 20, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "18:50", night: null } },
            { code: "YAN4", name: "ì¿ íŒ¡ ì–‘ì§€4ì„¼í„°", lat: 37.228, lng: 127.296, kakao_km: 14.9, kakao_min: 22, shifts: ["Day", "Swing", "Night"], shift_times: { day: "07:50", swing: "16:50", night: "20:50" } },
            { code: "YAN7", name: "ì¿ íŒ¡ ì–‘ì§€7ì„¼í„°", lat: 37.228, lng: 127.296, kakao_km: 14.9, kakao_min: 22, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "YON5", name: "ì¿ íŒ¡ ìš©ì¸5ì„¼í„°", lat: 37.177, lng: 127.18, kakao_km: 17.0, kakao_min: 32, shifts: ["Day", "Swing", "Night"], shift_times: { day: "07:50", swing: "16:50", night: "20:50" } },
            { code: "YON3", name: "ì¿ íŒ¡ ìš©ì¸3ì„¼í„°", lat: 37.177, lng: 127.18, kakao_km: 17.0, kakao_min: 32, shifts: ["Day", "Swing", "Night"], shift_times: { day: "07:50", swing: "16:50", night: "20:50" } },
            { code: "KKW1", name: "ì¿ íŒ¡ ê´‘êµ1ì„¼í„°", lat: 37.314, lng: 127.343, kakao_km: 18.8, kakao_min: 26, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "18:50", night: null } },
            { code: "DON1", name: "ì¿ íŒ¡ ë™íƒ„1ì„¼í„°", lat: 37.172, lng: 127.126, kakao_km: 20.3, kakao_min: 24, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "17:50", night: null } },
            { code: "YONDIP", name: "ì¿ íŒ¡ ìš©ì¸ë•í‰ì„¼í„°", lat: 37.182, lng: 127.333, kakao_km: 20.4, kakao_min: 27, shifts: ["Day", "Swing", "Night"], shift_times: { day: "06:50", swing: "14:50", night: "22:50" } },
            { code: "MAJ1", name: "ì¿ íŒ¡ ë§ˆì¥1ì„¼í„°", lat: 37.203, lng: 127.361, kakao_km: 24.8, kakao_min: 32, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "18:50", night: null } },
            { code: "GON2", name: "ì¿ íŒ¡ ê³¤ì§€ì•”2ì„¼í„°", lat: 37.365, lng: 127.336, kakao_km: 26.1, kakao_min: 28, shifts: ["Day"], shift_times: { day: "07:50", swing: null, night: null } },
            { code: "ECH2", name: "ì¿ íŒ¡ ì´ì²œ2ì„¼í„°", lat: 37.283, lng: 127.39, kakao_km: 26.9, kakao_min: 35, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "18:50", night: null } },
            { code: "HOB1", name: "ì¿ íŒ¡ í˜¸ë²•1ì„¼í„°", lat: 37.19, lng: 127.375, kakao_km: 27.2, kakao_min: 35, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "YON1", name: "ì¿ íŒ¡ ìš©ì¸1ì„¼í„°", lat: 37.139, lng: 127.389, kakao_km: 28.4, kakao_min: 39, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "18:20", night: null } },
            { code: "GON1", name: "ì¿ íŒ¡ ê³¤ì§€ì•”1ì„¼í„°", lat: 37.352, lng: 127.362, kakao_km: 28.6, kakao_min: 32, shifts: ["Day", "Swing", "Night"], shift_times: { day: "07:50", swing: "16:50", night: "20:50" } },
            { code: "ANS5", name: "ì¿ íŒ¡ ì•ˆì„±5ì„¼í„°", lat: 37.048, lng: 127.164, kakao_km: 32.2, kakao_min: 46, shifts: ["Day", "Swing", "Night"], shift_times: { day: "08:50", swing: "18:50", night: "20:50" } },
            { code: "ECH1", name: "ì¿ íŒ¡ ì´ì²œ1ì„¼í„°", lat: 37.293, lng: 127.499, kakao_km: 38.9, kakao_min: 47, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "ECH3", name: "ì¿ íŒ¡ ì´ì²œ3ì„¼í„°", lat: 37.219, lng: 127.469, kakao_km: 39.4, kakao_min: 44, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "ECH4", name: "ì¿ íŒ¡ ì´ì²œ4ì„¼í„°", lat: 37.253, lng: 127.518, kakao_km: 39.5, kakao_min: 42, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "CHA8", name: "ì¿ íŒ¡ ì²œì•ˆ8ì„¼í„°", lat: 36.94, lng: 127.176, kakao_km: 48.0, kakao_min: 69, shifts: ["Day"], shift_times: { day: "07:50", swing: null, night: null } },
            { code: "ANS4", name: "ì¿ íŒ¡ ì•ˆì„±4ì„¼í„°", lat: 37.067, lng: 127.4, kakao_km: 48.5, kakao_min: 45, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "SIH2", name: "ì¿ íŒ¡ ì‹œí¥2ì„¼í„°", lat: 37.332, lng: 126.747, kakao_km: 48.8, kakao_min: 52, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "17:50", night: null } },
            { code: "SIH3", name: "ì¿ íŒ¡ ì‹œí¥3ì„¼í„°", lat: 37.332, lng: 126.747, kakao_km: 48.8, kakao_min: 52, shifts: ["Day", "Swing"], shift_times: { day: "07:50", swing: "17:50", night: null } },
            { code: "SIH1", name: "ì¿ íŒ¡ ì‹œí¥1ì„¼í„°", lat: 37.332, lng: 126.747, kakao_km: 48.8, kakao_min: 52, shifts: ["Day", "Swing", "Night"], shift_times: { day: "07:50", swing: "16:50", night: "20:50" } },
            { code: "YEO1", name: "ì¿ íŒ¡ ì—¬ì£¼1ì„¼í„°", lat: 37.249, lng: 127.64, kakao_km: 49.1, kakao_min: 45, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "YEO2", name: "ì¿ íŒ¡ ì—¬ì£¼2ì„¼í„°", lat: 37.249, lng: 127.64, kakao_km: 49.1, kakao_min: 45, shifts: ["Day", "Swing"], shift_times: { day: "08:50", swing: "18:50", night: null } },
            { code: "ANS8", name: "ì¿ íŒ¡ ì•ˆì„±8ì„¼í„°", lat: 37.118, lng: 127.498, kakao_km: 49.4, kakao_min: 50, shifts: ["Day", "Swing", "Night"], shift_times: { day: "08:50", swing: "18:50", night: "20:00" } }
        ];

        // ë ˆì´ì–´ í‘œì‹œ ì—¬ë¶€
        let showStations = true;
        let showCustomers = true;
        let showCoupangFC = true;
        let showDepots = true;

        let MTOP_TARGET = 30000;
        let DAILY_TARGET = 1000;

        // ========== MTOP TARGET MANAGEMENT ==========
        function updateDailyTarget(value) {
            // Round to nearest 100
            value = Math.round(value / 100) * 100;
            value = Math.max(100, Math.min(1500, value));

            DAILY_TARGET = value;
            MTOP_TARGET = value * 30;

            // Update UI
            document.getElementById('dailyTargetSlider').value = value;
            document.getElementById('dailyTargetInput').value = value;
            document.getElementById('monthlyTargetCalc').textContent = MTOP_TARGET.toLocaleString() + ' kg';
            document.getElementById('mtopTargetLabel').textContent = MTOP_TARGET.toLocaleString() + ' kg (MTOP)';
            document.getElementById('mtopTargetDisplay').innerHTML = MTOP_TARGET.toLocaleString() + '<span class="text-lg ml-1">kg</span>';

            // Re-calculate simulation with new target
            const currentRadius = parseInt(document.getElementById('radiusSlider').value);
            updateSimulation(currentRadius);
        }

        // ========== MAP (Leaflet + OpenStreetMap) ==========
        let map, radiusCircle;
        let stationMarkers = [];   // ì¶©ì „ì†Œ ë§ˆì»¤
        let customerMarkers = [];  // ê±°ë˜ì²˜ ë§ˆì»¤
        let coupangMarkers = [];   // ì ì¬ê³ ê°(FC) ë§ˆì»¤
        let depotMarkers = [];     // ë²„ìŠ¤ì°¨ê³ ì§€ ë§ˆì»¤
        let mapLoaded = false;

        // FC ê±°ë¦¬ë³„ ìƒ‰ìƒ ë°˜í™˜
        function getFCColor(distanceKm) {
            if (distanceKm <= 20) return '#10B981'; // ê·¼ê±°ë¦¬: ì´ˆë¡
            if (distanceKm <= 30) return '#F59E0B'; // ì¤‘ê±°ë¦¬: ë…¸ë‘/ì£¼í™©
            return '#F97316'; // ì›ê±°ë¦¬: ì£¼í™©
        }

        // FC ê±°ë¦¬ ì¹´í…Œê³ ë¦¬ ë°˜í™˜
        function getFCCategory(distanceKm) {
            if (distanceKm <= 20) return 'ê·¼ê±°ë¦¬ (0-20km)';
            if (distanceKm <= 30) return 'ì¤‘ê±°ë¦¬ (20-30km)';
            return 'ì›ê±°ë¦¬ (30-50km)';
        }

        // FC ë§ˆì»¤ ì¶”ê°€
        function addFCMarker(fc) {
            const color = getFCColor(fc.kakao_km);
            const hasAllShifts = fc.shifts.length === 3;
            const borderStyle = hasAllShifts ? '3px solid #DC2626' : '2px solid #fff';

            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background:${color};width:22px;height:22px;border-radius:4px;border:${borderStyle};box-shadow:0 2px 5px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;color:#fff;font-size:10px;font-weight:bold;">ğŸ“¦</div>`,
                iconSize: [22, 22],
                iconAnchor: [11, 11]
            });

            // ê·¼ë¬´ì¡° ì •ë³´ HTML
            const shiftInfo = fc.shifts.map(s => {
                const time = fc.shift_times[s.toLowerCase()];
                const emoji = s === 'Day' ? 'ğŸŒ…' : s === 'Swing' ? 'ğŸŒ†' : 'ğŸŒ™';
                return `${emoji} ${s}: ${time || '-'}`;
            }).join('<br>');

            const popupContent = `
                <div style="min-width:180px;">
                    <strong style="color:${color};font-size:14px;">ğŸ“¦ ${fc.name}</strong>
                    ${hasAllShifts ? '<span style="background:#DC2626;color:#fff;font-size:10px;padding:1px 4px;border-radius:3px;margin-left:5px;">3êµëŒ€</span>' : ''}
                    <hr style="margin:6px 0;border:none;border-top:1px solid #eee;">
                    <div style="font-size:12px;color:#666;">
                        <div><strong>ë„ë¡œ ê±°ë¦¬:</strong> ${fc.kakao_km.toFixed(1)} km</div>
                        <div><strong>ì´ë™ì‹œê°„:</strong> ${fc.kakao_min}ë¶„</div>
                        <div><strong>ë¶„ë¥˜:</strong> ${getFCCategory(fc.kakao_km)}</div>
                    </div>
                    <hr style="margin:6px 0;border:none;border-top:1px solid #eee;">
                    <div style="font-size:11px;color:#555;">
                        <strong>ê·¼ë¬´ì¡°ë³„ ì¶œê·¼ì‹œê°„:</strong><br>
                        ${shiftInfo}
                    </div>
                </div>
            `;

            const marker = L.marker([fc.lat, fc.lng], { icon: icon })
                .bindPopup(popupContent);

            if (showCoupangFC) {
                marker.addTo(map);
            }

            coupangMarkers.push(marker);
        }

        // FC ë§ˆì»¤ í‘œì‹œ/ìˆ¨ê¸°ê¸° í† ê¸€
        function toggleCoupangFC(show) {
            showCoupangFC = show;
            coupangMarkers.forEach(marker => {
                if (show) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        // ê±°ë¦¬ë³„ ìƒ‰ìƒ ë°˜í™˜ (ê³µí†µ)
        function getDistanceColor(distanceKm) {
            if (distanceKm <= 10) return '#22C55E'; // ì´ˆë¡
            if (distanceKm <= 30) return '#EAB308'; // ë…¸ë‘
            return '#F97316'; // ì£¼í™©
        }

        // ë²„ìŠ¤ ì°¨ê³ ì§€ ë§ˆì»¤ ì¶”ê°€
        function addDepotMarker(depot) {
            const hasH2Bus = depot.h2_buses > 0;
            const color = hasH2Bus ? '#06B6D4' : '#8B5CF6';
            const borderColor = hasH2Bus ? '#0891B2' : '#7C3AED';

            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background:${color};width:26px;height:26px;border-radius:4px;border:3px solid ${borderColor};box-shadow:0 2px 6px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;font-weight:bold;clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);">ğŸšŒ</div>`,
                iconSize: [26, 26],
                iconAnchor: [13, 13]
            });

            const typeLabel = depot.type === 'city_bus' ? 'ì‹œë‚´ë²„ìŠ¤' : depot.type === 'express_bus' ? 'ê´‘ì—­ë²„ìŠ¤' : 'ì „ì„¸ë²„ìŠ¤';
            const h2Badge = hasH2Bus ? `<span style="background:#06B6D4;color:#fff;font-size:10px;padding:1px 5px;border-radius:3px;margin-left:5px;">Hâ‚‚ ${depot.h2_buses}ëŒ€</span>` : '';

            const popupContent = `
                <div style="min-width:200px;">
                    <strong style="color:${color};font-size:14px;">ğŸšŒ ${depot.name}</strong>${h2Badge}
                    <hr style="margin:6px 0;border:none;border-top:1px solid #eee;">
                    <div style="font-size:12px;color:#666;">
                        <div><strong>ìš´ì˜ì‚¬:</strong> ${depot.company}</div>
                        <div><strong>ìœ í˜•:</strong> ${typeLabel}</div>
                        <div><strong>ë„ë¡œ ê±°ë¦¬:</strong> ${depot.road_distance_km} km (${depot.road_time_min}ë¶„)</div>
                        ${depot.notes ? `<div style="margin-top:4px;padding:4px;background:#f3f4f6;border-radius:4px;font-size:11px;"><strong>ğŸ“Œ</strong> ${depot.notes}</div>` : ''}
                    </div>
                </div>
            `;

            const marker = L.marker([depot.lat, depot.lng], { icon: icon })
                .bindPopup(popupContent);

            if (showDepots) {
                marker.addTo(map);
            }

            depotMarkers.push(marker);
        }

        // ë²„ìŠ¤ ì°¨ê³ ì§€ ë§ˆì»¤ í† ê¸€
        function toggleDepots(show) {
            showDepots = show;
            depotMarkers.forEach(marker => {
                if (show) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        // ì¶©ì „ì†Œ ë§ˆì»¤ í† ê¸€
        function toggleStations(show) {
            showStations = show;
            stationMarkers.forEach(marker => {
                if (show) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        // ê±°ë˜ì²˜ ë§ˆì»¤ í† ê¸€
        function toggleCustomers(show) {
            showCustomers = show;
            customerMarkers.forEach(marker => {
                if (show) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        // Reset map to default center (POGOK_STATION)
        function resetMapView() {
            if (map) {
                map.setView([POGOK_STATION.lat, POGOK_STATION.lng], 10);
            }
        }

        function initMap() {
            try {
                // Initialize Leaflet map
                map = L.map('map').setView([POGOK_STATION.lat, POGOK_STATION.lng], 10);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors'
                }).addTo(map);

                mapLoaded = true;

                // Add Pogok station marker (new station - red star)
                addMarker(POGOK_STATION.lat, POGOK_STATION.lng, 'pogok', POGOK_STATION.name);

                // Add existing charging stations (green circles)
                CHARGING_STATIONS.forEach(station => {
                    addMarker(station.lat, station.lng, 'station', station.name, station.total_kg);
                });

                // Add customer markers (blue squares) - í˜„ì¬ ê±°ë˜ì²˜
                CUSTOMERS.forEach(customer => {
                    addMarker(customer.lat, customer.lng, 'customer', customer.name, customer.total_kg, customer.road_distance_km);
                });

                // Add Coupang FC markers (orange diamonds) - ì ì¬ê³ ê°
                COUPANG_FC.forEach(fc => {
                    addFCMarker(fc);
                });

                // Add Bus Depot markers (purple hexagons) - ë²„ìŠ¤ ì°¨ê³ ì§€
                BUS_DEPOTS.forEach(depot => {
                    addDepotMarker(depot);
                });

                // Initial radius circle
                updateRadiusCircle(30);
            } catch (e) {
                console.error('Map initialization failed:', e);
                document.getElementById('map').innerHTML = `
                    <div class="h-full flex items-center justify-center bg-gray-100 text-gray-500">
                        <div class="text-center p-8">
                            <div class="text-4xl mb-4">ğŸ—ºï¸</div>
                            <div class="font-semibold mb-2">ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨</div>
                            <div class="text-sm">${e.message}</div>
                        </div>
                    </div>
                `;
            }
        }

        function addMarker(lat, lng, type, title, amount, distance) {
            let icon, popupContent, marker;

            if (type === 'pogok') {
                // Red star marker for new station (í¬ê³¡ ì‹ ê·œ ì¶©ì „ì†Œ)
                icon = L.divIcon({
                    className: 'custom-marker',
                    html: '<div style="background:linear-gradient(135deg, #EF4444 0%, #DC2626 100%);width:32px;height:32px;border-radius:50%;border:3px solid #fff;box-shadow:0 3px 8px rgba(239,68,68,0.5);display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px;">â˜…</div>',
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                });
                popupContent = `
                    <div style="min-width:180px;">
                        <strong style="color:#EF4444;font-size:14px;">ğŸ†• ${title}</strong>
                        <span style="background:#EF4444;color:#fff;font-size:9px;padding:1px 4px;border-radius:3px;margin-left:5px;">ì‹ ê·œ</span>
                        <hr style="margin:6px 0;border:none;border-top:1px solid #eee;">
                        <div style="font-size:12px;color:#666;">
                            <div>ğŸ“… 2026ë…„ 10ì›” ì˜¤í”ˆ ì˜ˆì •</div>
                            <div>ğŸ“ ìš©ì¸ì‹œ ì²˜ì¸êµ¬ í¬ê³¡ì ì‚¼ê³„ë¦¬</div>
                        </div>
                    </div>
                `;
                marker = L.marker([lat, lng], { icon: icon }).addTo(map).bindPopup(popupContent);
            } else if (type === 'station') {
                // Green circle marker for existing stations (ê¸°ì¡´ ì¶©ì „ì†Œ)
                icon = L.divIcon({
                    className: 'custom-marker',
                    html: '<div style="background:linear-gradient(135deg, #22C55E 0%, #16A34A 100%);width:22px;height:22px;border-radius:50%;border:2px solid #fff;box-shadow:0 2px 5px rgba(34,197,94,0.4);display:flex;align-items:center;justify-content:center;color:#fff;font-size:11px;">â›½</div>',
                    iconSize: [22, 22],
                    iconAnchor: [11, 11]
                });
                popupContent = `
                    <div style="min-width:180px;">
                        <strong style="color:#16A34A;font-size:13px;">â›½ ${title}</strong>
                        <hr style="margin:6px 0;border:none;border-top:1px solid #eee;">
                        <div style="font-size:12px;color:#666;">
                            <div><strong>ì¶©ì „ëŸ‰:</strong> ${amount?.toLocaleString() || 0} kg</div>
                        </div>
                    </div>
                `;
                marker = L.marker([lat, lng], { icon: icon }).bindPopup(popupContent);
                if (showStations) marker.addTo(map);
                stationMarkers.push(marker);
                return;
            } else {
                // Blue square marker for customers (í˜„ì¬ ê±°ë˜ì²˜)
                const distColor = getDistanceColor(distance || 50);
                icon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background:linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);width:20px;height:20px;border-radius:4px;border:2px solid #fff;box-shadow:0 2px 5px rgba(59,130,246,0.4);display:flex;align-items:center;justify-content:center;color:#fff;font-size:10px;">ğŸ¢</div>`,
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });
                const distBadge = distance <= 30 ? `<span style="background:#22C55E;color:#fff;font-size:9px;padding:1px 4px;border-radius:3px;margin-left:5px;">ì¸ê·¼</span>` : '';
                popupContent = `
                    <div style="min-width:180px;">
                        <strong style="color:#2563EB;font-size:13px;">ğŸ¢ ${title}</strong>${distBadge}
                        <hr style="margin:6px 0;border:none;border-top:1px solid #eee;">
                        <div style="font-size:12px;color:#666;">
                            <div><strong>11ì›” ì¶©ì „ëŸ‰:</strong> ${amount?.toLocaleString() || 0} kg</div>
                            <div><strong>ë„ë¡œ ê±°ë¦¬:</strong> ${distance?.toFixed(1) || '?'} km</div>
                        </div>
                    </div>
                `;
                marker = L.marker([lat, lng], { icon: icon }).bindPopup(popupContent);
                if (showCustomers) marker.addTo(map);
                customerMarkers.push(marker);
                return;
            }
        }

        function updateRadiusCircle(radiusKm) {
            if (!mapLoaded) return;

            if (radiusCircle) {
                map.removeLayer(radiusCircle);
            }

            radiusCircle = L.circle([POGOK_STATION.lat, POGOK_STATION.lng], {
                radius: radiusKm * 1000,
                color: '#3B82F6',
                weight: 2,
                opacity: 0.8,
                dashArray: '10, 10',
                fillColor: '#3B82F6',
                fillOpacity: 0.1
            }).addTo(map);

            // ë°˜ê²½ 25km ì´ìƒì¼ ë•Œ ì§€ë„ë¥¼ ì› ë²”ìœ„ì— ë§ì¶¤
            if (radiusKm >= 25) {
                map.fitBounds(radiusCircle.getBounds(), { padding: [20, 20] });
            } else {
                // ì‘ì€ ë°˜ê²½ì¼ ë•ŒëŠ” ê¸°ë³¸ ì¤Œ ë ˆë²¨ ìœ ì§€
                map.setView([POGOK_STATION.lat, POGOK_STATION.lng], 10);
            }
        }

        // ========== SIMULATION ==========
        function updateSimulation(radiusKm) {
            // ì§ì„ ê±°ë¦¬(ì¢Œí‘œ ê¸°ë°˜) í•„í„°ë§ - road_distance_km(ë„ë¡œê±°ë¦¬)ê°€ ì•„ë‹Œ Haversine ê±°ë¦¬ ì‚¬ìš©
            const customersInRange = CUSTOMERS.filter(c => getDistanceFromStation(c.lat, c.lng) <= radiusKm);
            const totalKg = customersInRange.reduce((sum, c) => sum + c.total_kg, 0);
            const totalH2Buses = customersInRange.reduce((sum, c) => sum + (c.h2_buses || 0), 0);
            const mtopPercent = (totalKg / MTOP_TARGET) * 100;
            const displayPercent = Math.min(mtopPercent, 100);

            // Update results display with enhanced styling
            document.getElementById('simulationResults').innerHTML = `
                <div class="bg-gradient-to-br from-blue-50 to-blue-100/50 rounded-xl p-4 border border-blue-200/50">
                    <div class="flex items-center gap-2 mb-1">
                        <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                        </svg>
                        <span class="text-sm text-gray-600">ë°˜ê²½ ${radiusKm}km ì´ë‚´</span>
                    </div>
                    <div class="text-2xl font-bold text-blue-700">${customersInRange.length}<span class="text-base font-normal ml-1">ê°œ ê±°ë˜ì²˜</span></div>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-emerald-100/50 rounded-xl p-4 border border-green-200/50">
                    <div class="flex items-center gap-2 mb-1">
                        <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/>
                        </svg>
                        <span class="text-sm text-gray-600">ì›ë” ìˆ˜ì†Œë²„ìŠ¤ ëŒ€ìˆ˜</span>
                    </div>
                    <div class="text-2xl font-bold text-green-700">${totalH2Buses}<span class="text-base font-normal ml-1">ëŒ€</span></div>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-violet-100/50 rounded-xl p-4 border border-purple-200/50">
                    <div class="flex items-center gap-2 mb-1">
                        <svg class="w-4 h-4 text-purple-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19.77 7.23l.01-.01-3.72-3.72L15 4.56l2.11 2.11c-.94.36-1.61 1.26-1.61 2.33 0 1.38 1.12 2.5 2.5 2.5.36 0 .69-.08 1-.21v7.21c0 .55-.45 1-1 1s-1-.45-1-1V14c0-1.1-.9-2-2-2h-1V5c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v16h10v-7.5h1.5v5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V9c0-.69-.28-1.32-.73-1.77z"/>
                        </svg>
                        <span class="text-sm text-gray-600">ì›”ê°„ ì¶©ì „ëŸ‰</span>
                    </div>
                    <div class="text-2xl font-bold text-purple-700">${totalKg.toLocaleString()}<span class="text-base font-normal ml-1">kg</span></div>
                </div>
            `;

            // Update MTOP bar with enhanced styling
            const mtopBar = document.getElementById('mtopBar');
            const mtopStatus = document.getElementById('mtopStatus');

            document.getElementById('mtopLabel').textContent = `ì˜ˆìƒ ì¶©ì „ëŸ‰: ${totalKg.toLocaleString()} kg`;
            document.getElementById('mtopPercent').textContent = `${mtopPercent.toFixed(1)}%`;
            document.getElementById('mtopBarText').textContent = displayPercent > 15 ? `${mtopPercent.toFixed(0)}%` : '';
            mtopBar.style.width = `${displayPercent}%`;

            // Calculate shortage and needed buses for business-oriented messages
            const shortage = Math.max(0, MTOP_TARGET - totalKg);
            const avgKgPerBus = 247.86; // í‰ê·  ì¶©ì „ëŸ‰ (kg/ëŒ€/ì›”)
            const neededBuses = Math.ceil(shortage / avgKgPerBus);

            // Change color and message based on percentage
            if (mtopPercent >= 100) {
                mtopBar.className = 'progress-bar bg-gradient-to-r from-green-500 to-emerald-600 h-5 rounded-full flex items-center justify-end pr-2';
                mtopStatus.className = 'flex items-center gap-2 p-3 rounded-lg bg-green-50 border border-green-200';
                mtopStatus.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    <span class="text-sm text-green-700 font-medium">âœ“ MTOP ëª©í‘œ ë‹¬ì„±! ì•ˆì •ì  ìˆ˜ìµ êµ¬ì¡° í™•ë³´</span>
                `;
            } else if (mtopPercent >= 70) {
                mtopBar.className = 'progress-bar bg-gradient-to-r from-blue-500 to-blue-600 h-5 rounded-full flex items-center justify-end pr-2';
                mtopStatus.className = 'flex items-center gap-2 p-3 rounded-lg bg-blue-50 border border-blue-200';
                mtopStatus.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-blue-500 animate-pulse"></div>
                    <span class="text-sm text-blue-700">ëª©í‘œì˜ ${mtopPercent.toFixed(0)}% ë‹¬ì„± - <strong>ì•½ ${neededBuses}ëŒ€</strong> ì¶”ê°€ ì˜ì—…ìœ¼ë¡œ ë‹¬ì„± ê°€ëŠ¥</span>
                `;
            } else if (mtopPercent >= 40) {
                mtopBar.className = 'progress-bar bg-gradient-to-r from-yellow-500 to-amber-500 h-5 rounded-full flex items-center justify-end pr-2';
                mtopStatus.className = 'flex items-center gap-2 p-3 rounded-lg bg-yellow-50 border border-yellow-200';
                mtopStatus.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-yellow-500 animate-pulse"></div>
                    <span class="text-sm text-yellow-700">ì ê·¹ì  ê±°ë˜ì²˜ ì˜ì—… í•„ìš” (ë¶€ì¡±: ${shortage.toLocaleString()}kg, <strong>ì•½ ${neededBuses}ëŒ€</strong>)</span>
                `;
            } else {
                mtopBar.className = 'progress-bar bg-gradient-to-r from-red-400 to-rose-500 h-5 rounded-full flex items-center justify-end pr-2';
                mtopStatus.className = 'flex items-center gap-2 p-3 rounded-lg bg-red-50 border border-red-200';
                mtopStatus.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></div>
                    <span class="text-sm text-red-700">ì‹ ê·œ ê±°ë˜ì²˜ ë°œêµ´ ìš°ì„  (ë¶€ì¡±: ${shortage.toLocaleString()}kg, <strong>ì•½ ${neededBuses}ëŒ€</strong>) / MTOP ë‹¨ê³„ ì¬ê²€í† </span>
                `;
            }

            // Update radius circle
            updateRadiusCircle(radiusKm);

            // Update customers in range table (ë°˜ê²½ ë‚´ ê±°ë˜ì²˜ ìƒì„¸ í…Œì´ë¸”)
            const customersTableBody = document.getElementById('customersInRangeTable');
            if (customersInRange.length > 0) {
                // Sort by straight-line distance (ì§ì„ ê±°ë¦¬ ìˆœ)
                const sortedCustomers = [...customersInRange].sort((a, b) =>
                    getDistanceFromStation(a.lat, a.lng) - getDistanceFromStation(b.lat, b.lng));
                customersTableBody.innerHTML = sortedCustomers.map(c => `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="px-2 py-1.5 text-left font-medium text-gray-800">${c.name}</td>
                        <td class="px-2 py-1.5 text-right"><span class="bg-cyan-100 text-cyan-700 px-1.5 py-0.5 rounded text-xs font-bold">${c.h2_buses || 0}ëŒ€</span></td>
                        <td class="px-2 py-1.5 text-right text-gray-700">${c.total_kg.toLocaleString()} kg</td>
                        <td class="px-2 py-1.5 text-right text-gray-500">${c.road_distance_km} km</td>
                    </tr>
                `).join('');
                document.getElementById('customersInRangeSection').style.display = 'block';
            } else {
                customersTableBody.innerHTML = `
                    <tr><td colspan="4" class="px-2 py-4 text-center text-gray-400 text-xs">ë°˜ê²½ ë‚´ ê±°ë˜ì²˜ ì—†ìŒ</td></tr>
                `;
                document.getElementById('customersInRangeSection').style.display = 'block';
            }
        }

        // ========== CHARTS ==========
        let customerChartInstance = null;
        let companyChartInstance = null;

        function initCharts() {
            // Company Chart (ì¶•ì†Œëœ ë„ë„› ì°¨íŠ¸) - ì›”ë³„ ë°ì´í„° ì‚¬ìš©
            updateCompanyChartByMonth();

            // Company Detail Table (ë²•ì¸ë³„ ìƒì„¸ í…Œì´ë¸”)
            renderCompanyDetailTable();

            // Customer Chart (ì´ˆê¸° 10ê°œ)
            updateCustomerChart(10);

            // N-selector ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('topNSelector').addEventListener('change', (e) => {
                updateCustomerChart(parseInt(e.target.value));
            });
        }

        // ë²•ì¸ë³„ ìƒì„¸ í…Œì´ë¸” ë Œë”ë§ (ì›”ë³„ ë°ì´í„° ì‚¬ìš©)
        function renderCompanyDetailTable() {
            const companies = MONTHLY_DATA[currentMonth].companies;
            const rows = Object.entries(companies).map(([name, data]) => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-2 py-1 font-medium whitespace-nowrap">
                        <span class="inline-block w-2 h-2 rounded-full mr-1" style="background:${data.color}"></span>
                        ${name}
                    </td>
                    <td class="px-2 py-1 text-right">${data.customers}ê°œ</td>
                    <td class="px-2 py-1 text-right">${data.vehicles}ëŒ€</td>
                    <td class="px-2 py-1 text-right font-medium text-blue-600">${data.total_kg.toLocaleString()}</td>
                    <td class="px-2 py-1 text-right">${data.charge_count}íšŒ</td>
                    <td class="px-2 py-1 text-right">${data.daily_avg.toFixed(1)}</td>
                    <td class="px-2 py-1 text-right">${data.charge_cycle.toFixed(2)}ì¼</td>
                </tr>
            `).join('');
            document.getElementById('companyDetailTable').innerHTML = rows;
        }

        // ë²•ì¸ë³„ ì¶©ì „ëŸ‰ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ì›”ë³„ ë°ì´í„°)
        function updateCompanyChartByMonth() {
            const companies = MONTHLY_DATA[currentMonth].companies;

            if (companyChartInstance) {
                companyChartInstance.destroy();
            }

            const totalKg = Object.values(companies).reduce((sum, c) => sum + c.total_kg, 0);

            companyChartInstance = new Chart(document.getElementById('companyChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(companies),
                    datasets: [{
                        data: Object.values(companies).map(c => c.total_kg),
                        backgroundColor: Object.values(companies).map(c => c.color)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const pct = ((value / totalKg) * 100).toFixed(1);
                                    return `${context.label}: ${value.toLocaleString()} kg (${pct}%)`;
                                }
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'datalabels',
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        chart.data.datasets.forEach((dataset, i) => {
                            const meta = chart.getDatasetMeta(i);
                            meta.data.forEach((element, index) => {
                                const data = dataset.data[index];
                                const pct = ((data / totalKg) * 100).toFixed(0);
                                const label = chart.data.labels[index];

                                // ì¤‘ì‹¬ì  ê³„ì‚°
                                const centerX = element.x;
                                const centerY = element.y;
                                const startAngle = element.startAngle;
                                const endAngle = element.endAngle;
                                const midAngle = (startAngle + endAngle) / 2;
                                const radius = (element.innerRadius + element.outerRadius) / 2;

                                const x = centerX + Math.cos(midAngle) * radius;
                                const y = centerY + Math.sin(midAngle) * radius;

                                ctx.save();
                                ctx.fillStyle = '#fff';
                                ctx.font = 'bold 11px sans-serif';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
                                ctx.fillText(`${label}`, x, y - 6);
                                ctx.fillText(`${pct}%`, x, y + 6);
                                ctx.restore();
                            });
                        });
                    }
                }]
            });
        }

        // ê±°ë˜ì²˜ë³„ ì¶©ì „ëŸ‰ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ë™ì  Nê°œ)
        function updateCustomerChart(topN = 10) {
            const topCustomers = [...CUSTOMERS]
                .sort((a, b) => b.total_kg - a.total_kg)
                .slice(0, topN);

            // í™•ì¥ëœ ë¼ë²¨: "ê±°ë˜ì²˜ëª… - ë²„ìŠ¤ëŒ€ìˆ˜, ì¶©ì „íšŸìˆ˜"
            const labels = topCustomers.map(c => {
                const shortName = c.name.length > 10 ? c.name.substring(0, 10) + '..' : c.name;
                return `${shortName} - ${c.h2_buses}ëŒ€, ${c.charge_count}íšŒ`;
            });

            // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ë†’ì´ ë™ì  ì„¤ì • (í•­ëª©ë‹¹ 35px)
            const chartContainer = document.getElementById('customerChart').parentElement;
            const chartHeight = Math.max(200, topN * 35);
            chartContainer.style.height = chartHeight + 'px';

            if (customerChartInstance) {
                customerChartInstance.destroy();
            }

            customerChartInstance = new Chart(document.getElementById('customerChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì¶©ì „ëŸ‰ (kg)',
                        data: topCustomers.map(c => c.total_kg),
                        backgroundColor: '#3B82F6'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' kg';
                                }
                            }
                        },
                        y: {
                            ticks: {
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        // ========== SORTING ==========
        // ê° í…Œì´ë¸”ì˜ ê¸°ë³¸ ì •ë ¬ ìƒíƒœ (ì´ˆê¸°ê°’)
        const defaultSort = {
            customer: { field: 'road_distance_km', direction: 'asc' },
            potential: { field: 'kakao_km', direction: 'asc' },
            depot: { field: 'road_distance_km', direction: 'asc' },
            station: { field: 'total_kg', direction: 'desc' }
        };

        // í…Œì´ë¸” ì •ë ¬ ìƒíƒœ ê´€ë¦¬ (null = ê¸°ë³¸ê°’ ì‚¬ìš©)
        const sortState = {
            customer: { field: null, direction: null },
            potential: { field: null, direction: null },
            depot: { field: null, direction: null },
            station: { field: null, direction: null }
        };

        // ì •ë ¬ í•¨ìˆ˜ (3ë‹¨ê³„: ê¸°ë³¸ê°’ â†’ ì˜¤ë¦„ì°¨ìˆœ â†’ ë‚´ë¦¼ì°¨ìˆœ â†’ ê¸°ë³¸ê°’)
        function sortTable(tableType, field) {
            const state = sortState[tableType];
            
            if (state.field === field) {
                // ê°™ì€ í•„ë“œ í´ë¦­ì‹œ 3ë‹¨ê³„ ìˆœí™˜
                if (state.direction === 'asc') {
                    state.direction = 'desc';
                } else if (state.direction === 'desc') {
                    // ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µê·€
                    state.field = null;
                    state.direction = null;
                } else {
                    state.direction = 'asc';
                }
            } else {
                // ë‹¤ë¥¸ í•„ë“œ í´ë¦­ì‹œ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì‹œì‘
                state.field = field;
                state.direction = 'asc';
            }
            
            initTables();
            updateSortIndicators(tableType);
        }

        // ì‹¤ì œ ì •ë ¬ì— ì‚¬ìš©í•  ê°’ ë°˜í™˜
        function getActiveSort(tableType) {
            const state = sortState[tableType];
            if (state.field === null) {
                return defaultSort[tableType];
            }
            return state;
        }

        // ì •ë ¬ ë°©í–¥ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSortIndicators(tableType) {
            const tableId = {
                customer: 'customerTableHeaders',
                potential: 'potentialTableHeaders',
                depot: 'depotTableHeaders',
                station: 'stationTableHeaders'
            }[tableType];
            
            const headers = document.getElementById(tableId)?.querySelectorAll('th[data-sort]');
            if (!headers) return;
            
            const state = sortState[tableType];
            const def = defaultSort[tableType];
            
            headers.forEach(th => {
                const icon = th.querySelector('.sort-icon');
                if (icon) {
                    const field = th.dataset.sort;
                    
                    if (state.field === field) {
                        // ì‚¬ìš©ì ì§€ì • ì •ë ¬
                        icon.textContent = state.direction === 'asc' ? ' â–²' : ' â–¼';
                        icon.className = 'sort-icon text-blue-600';
                    } else if (state.field === null && field === def.field) {
                        // ê¸°ë³¸ ì •ë ¬ (íšŒìƒ‰ í‘œì‹œ)
                        icon.textContent = def.direction === 'asc' ? ' â–³' : ' â–½';
                        icon.className = 'sort-icon text-gray-400';
                    } else {
                        // ë¯¸ì •ë ¬
                        icon.textContent = ' â‡…';
                        icon.className = 'sort-icon text-gray-300';
                    }
                }
            });
        }

        // ========== TABLES ==========
        function initTables() {
            // ì›”ë³„ ì¶©ì „ì†Œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const currentStations = getChargingStationsForMonth(currentMonth);
            const totalCharge = currentStations.reduce((sum, s) => sum + s.total_kg, 0);
            // í˜„ì¬ ì„ íƒëœ ë°˜ê²½ ê°’ ê°€ì ¸ì˜¤ê¸°
            const currentRadius = parseInt(document.getElementById('radiusSlider')?.value || 30);

            // Customer Table (í˜„ì¬ ê±°ë˜ì²˜) - ìˆ˜ì†Œë²„ìŠ¤ ê¸°ì¤€ ë°ì´í„° + ì „ì›”ëŒ€ë¹„
            const customerRows = [...CUSTOMERS]
                .sort((a, b) => {
                    const sort = getActiveSort('customer');
                    const aVal = a[sort.field] ?? -9999;
                    const bVal = b[sort.field] ?? -9999;
                    const cmp = typeof aVal === 'string' ? aVal.localeCompare(bVal) : aVal - bVal;
                    return sort.direction === 'asc' ? cmp : -cmp;
                })
                .map((c, idx) => {
                    const straightDist = getDistanceFromStation(c.lat, c.lng);
                    const inRadius = straightDist <= currentRadius;
                    const distClass = inRadius ? 'bg-green-200 text-green-800 font-bold' : 'bg-gray-100 text-gray-600';

                    // ì „ì›” ëŒ€ë¹„ í‘œì‹œ
                    let changeKgHtml = '-';
                    let changePctHtml = '-';
                    if (c.change_kg !== null) {
                        const isUp = c.change_kg > 0;
                        const arrow = isUp ? 'â–²' : (c.change_kg < 0 ? 'â–¼' : '');
                        const color = isUp ? 'text-green-600' : (c.change_kg < 0 ? 'text-red-500' : 'text-gray-500');
                        changeKgHtml = `<span class="${color} font-medium">${arrow} ${isUp ? '+' : ''}${c.change_kg.toFixed(0).toLocaleString()} kg</span>`;
                        changePctHtml = `<span class="${color} font-medium">${isUp ? '+' : ''}${c.change_pct.toFixed(1)}%</span>`;
                    } else if (c.isNew) {
                        changeKgHtml = `<span class="text-blue-600 font-medium">ğŸ†• ì‹ ê·œ</span>`;
                        changePctHtml = '-';
                    }

                    // 10ì›”ì€ ì „ì›”ëŒ€ë¹„ ì»¬ëŸ¼ ì—†ìŒ
                    const showComparison = currentMonth === '2024-11';
                    const comparisonCells = showComparison ? `
                        <td class="px-3 py-2 text-right bg-gray-50 text-xs">${changeKgHtml}</td>
                        <td class="px-3 py-2 text-right bg-gray-50 text-xs">${changePctHtml}</td>
                    ` : '';

                    // ê±°ë¦¬ ë¹„êµ ê³„ì‚° (ê±°ë˜ì²˜â†’ê¸°ì¡´ì¶©ì „ì†Œ ê°€ì¤‘í‰ê·  vs ê±°ë˜ì²˜â†’í¬ê³¡)
                    const extAvgDist = calculateWeightedAvgDistance(c.displayName || c.name, currentMonth);

                    // ê±°ë˜ì²˜â†’í¬ê³¡ ê±°ë¦¬ ì¡°íšŒ (CUSTOMER_TO_POGOK_DISTANCE ìš°ì„  ì‚¬ìš©)
                    const customerKey = c.displayName || c.name;
                    const normalizedKey = normalizeName(customerKey);
                    let pogokDist = CUSTOMER_TO_POGOK_DISTANCE[customerKey]
                                 || CUSTOMER_TO_POGOK_DISTANCE[normalizedKey];
                    if (pogokDist === undefined) {
                        for (const key of Object.keys(CUSTOMER_TO_POGOK_DISTANCE)) {
                            if (customerKey.startsWith(key) || key.startsWith(customerKey) ||
                                normalizedKey.startsWith(key) || key.startsWith(normalizedKey)) {
                                pogokDist = CUSTOMER_TO_POGOK_DISTANCE[key];
                                break;
                            }
                        }
                    }
                    // fallback
                    if (pogokDist === undefined) pogokDist = c.road_distance_km;

                    const distChange = (extAvgDist !== null && pogokDist !== undefined) ? pogokDist - extAvgDist : null;

                    let extAvgHtml = '-';
                    let distChangeHtml = '-';
                    if (extAvgDist !== null) {
                        extAvgHtml = `<span class="text-gray-600">${extAvgDist.toFixed(1)} km</span>`;
                        const isCloser = distChange < 0;
                        const changeColor = isCloser ? 'text-green-600' : 'text-red-500';
                        const changeArrow = isCloser ? 'â–¼' : 'â–²';
                        const changeText = isCloser ? 'ê°€ê¹Œì›Œì§' : 'ë©€ì–´ì§';
                        distChangeHtml = `<span class="${changeColor} font-medium">${changeArrow} ${Math.abs(distChange).toFixed(1)} km</span><br><span class="text-xs ${changeColor}">${changeText}</span>`;
                    }

                    const displayName = c.displayName || c.name;
                    return `
                    <tr class="border-b hover:bg-blue-50 data-list-item cursor-pointer ${inRadius ? 'bg-green-50' : ''}"
                        onmouseenter="showStationTooltip(event, '${displayName.replace(/'/g, "\\'")}', '${currentMonth}')"
                        onmouseleave="hideStationTooltip()">
                        <td class="px-2 py-2 text-center text-gray-400 text-xs">${idx + 1}</td>
                        <td class="px-3 py-2 font-medium">${c.name}</td>
                        <td class="px-3 py-2 text-right"><span class="bg-cyan-100 text-cyan-700 px-2 py-0.5 rounded text-xs font-bold">${c.h2_buses || 0}ëŒ€</span></td>
                        <td class="px-3 py-2 text-right font-medium text-blue-600">${c.total_kg.toLocaleString()} kg</td>
                        ${comparisonCells}
                        <td class="px-3 py-2 text-right text-amber-600 text-xs">${c.cost_vat?.toLocaleString() || '-'}ì›</td>
                        <td class="px-3 py-2 text-right text-green-600 text-xs">${c.subsidy?.toLocaleString() || '-'}ì›</td>
                        <td class="px-3 py-2 text-right">${c.charge_count}íšŒ</td>
                        <td class="px-3 py-2 text-right">${c.avg_per_charge.toFixed(1)} kg</td>
                        <td class="px-3 py-2 text-right">
                            <span class="${distClass} px-2 py-0.5 rounded text-xs font-medium">${pogokDist?.toFixed(1) || '-'} km</span>
                        </td>
                        <td class="px-3 py-2 text-right bg-amber-50">${extAvgHtml}</td>
                        <td class="px-3 py-2 text-right bg-amber-50 text-xs">${distChangeHtml}</td>
                    </tr>
                `}).join('');

            // ì´íƒˆ ê³ ê° í‘œì‹œ (11ì›” ê¸°ì¤€) - 11ì›”ì—ë§Œ í‘œì‹œë¨
            const churnedCustomers = getChurnedCustomers(currentMonth);
            const showComparisonChurned = currentMonth === '2024-11';
            const churnedRows = churnedCustomers.map((c, idx) => {
                const comparisonCellsChurned = showComparisonChurned ? `
                    <td class="px-3 py-2 text-right bg-red-100"><span class="text-red-500 font-medium">â–¼ ${Math.abs(c.change_kg).toFixed(0)} kg</span></td>
                    <td class="px-3 py-2 text-right bg-red-100"><span class="text-red-500 font-medium">ì´íƒˆ</span></td>
                ` : '';
                return `
                <tr class="border-b bg-red-50 opacity-70">
                    <td class="px-2 py-2 text-center text-gray-400 text-xs">-</td>
                    <td class="px-3 py-2 font-medium text-gray-500 line-through">${c.displayName}</td>
                    <td class="px-3 py-2 text-right">-</td>
                    <td class="px-3 py-2 text-right text-gray-400">-</td>
                    ${comparisonCellsChurned}
                    <td class="px-3 py-2 text-right text-gray-400">-</td>
                    <td class="px-3 py-2 text-right text-gray-400">-</td>
                    <td class="px-3 py-2 text-right text-gray-400">-</td>
                    <td class="px-3 py-2 text-right text-gray-400">-</td>
                    <td class="px-3 py-2 text-right text-gray-400">-</td>
                    <td class="px-3 py-2 text-right bg-amber-50 text-gray-400">-</td>
                    <td class="px-3 py-2 text-right bg-amber-50 text-gray-400">-</td>
                </tr>
            `}).join('');

            document.getElementById('customerTable').innerHTML = customerRows + churnedRows;

            // Potential Table (ì¿ íŒ¡ FC - ì ì¬ê³ ê°)
            const potentialRows = [...COUPANG_FC]
                .sort((a, b) => {
                    const sort = getActiveSort('potential');
                    const aVal = a[sort.field];
                    const bVal = b[sort.field];
                    const cmp = typeof aVal === 'string' ? aVal.localeCompare(bVal) : aVal - bVal;
                    return sort.direction === 'asc' ? cmp : -cmp;
                })
                .map((fc, idx) => {
                    const straightDist = getDistanceFromStation(fc.lat, fc.lng);
                    const inRadius = straightDist <= currentRadius;
                    const shiftBadges = fc.shifts.map(s => {
                        const colors = { Day: 'bg-yellow-100 text-yellow-700', Swing: 'bg-orange-100 text-orange-700', Night: 'bg-purple-100 text-purple-700' };
                        return `<span class="${colors[s]} px-1.5 py-0.5 rounded text-[10px] font-medium">${s}</span>`;
                    }).join(' ');
                    const distClass = inRadius ? 'bg-green-200 text-green-800 font-bold px-2 py-0.5 rounded' :
                                      fc.kakao_km <= 20 ? 'text-green-600' : fc.kakao_km <= 30 ? 'text-yellow-600' : 'text-orange-600';
                    return `
                        <tr class="border-b hover:bg-orange-50 data-list-item ${inRadius ? 'bg-green-50' : ''}">
                            <td class="px-2 py-2 text-center text-gray-400 text-xs">${idx + 1}</td>
                            <td class="px-4 py-2 font-mono text-xs text-gray-500">${fc.code}</td>
                            <td class="px-4 py-2 font-medium">${fc.name.replace('ì¿ íŒ¡ ', '')}</td>
                            <td class="px-4 py-2 text-right">
                                <span class="${distClass} font-medium">${fc.kakao_km.toFixed(1)} km</span>
                            </td>
                            <td class="px-4 py-2 text-right text-gray-500">${fc.kakao_min}ë¶„</td>
                            <td class="px-4 py-2 text-center">${shiftBadges}</td>
                        </tr>
                    `;
                }).join('');
            document.getElementById('potentialTable').innerHTML = potentialRows;

            // Depot Table (ë²„ìŠ¤ ì°¨ê³ ì§€)
            const depotRows = [...BUS_DEPOTS]
                .sort((a, b) => {
                    const sort = getActiveSort('depot');
                    const aVal = a[sort.field];
                    const bVal = b[sort.field];
                    const cmp = typeof aVal === 'string' ? aVal.localeCompare(bVal) : aVal - bVal;
                    return sort.direction === 'asc' ? cmp : -cmp;
                })
                .map((d, idx) => {
                    const straightDist = getDistanceFromStation(d.lat, d.lng);
                    const inRadius = straightDist <= currentRadius;
                    const typeLabel = d.type === 'city_bus' ? 'ì‹œë‚´' : d.type === 'express_bus' ? 'ê´‘ì—­' : 'ì „ì„¸';
                    const typeColor = d.type === 'city_bus' ? 'bg-blue-100 text-blue-700' : d.type === 'express_bus' ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-700';
                    const h2Badge = d.h2_buses > 0 ? `<span class="bg-cyan-100 text-cyan-700 px-2 py-0.5 rounded text-xs font-bold">${d.h2_buses}ëŒ€</span>` : '<span class="text-gray-400 text-xs">-</span>';
                    const distClass = inRadius ? 'bg-green-200 text-green-800 font-bold px-2 py-0.5 rounded' : d.road_distance_km <= 10 ? 'text-green-600 font-bold' : 'text-gray-600';
                    const rowBg = d.h2_buses > 0 ? 'bg-cyan-50' : inRadius ? 'bg-green-50' : '';
                    return `
                        <tr class="border-b hover:bg-purple-50 data-list-item ${rowBg}">
                            <td class="px-2 py-2 text-center text-gray-400 text-xs">${idx + 1}</td>
                            <td class="px-4 py-2 font-medium">${d.name}</td>
                            <td class="px-4 py-2 text-gray-600 text-xs">${d.company}</td>
                            <td class="px-4 py-2 text-center"><span class="${typeColor} px-2 py-0.5 rounded text-xs font-medium">${typeLabel}</span></td>
                            <td class="px-4 py-2 text-right">
                                <span class="${distClass}">${d.road_distance_km} km</span>
                                <span class="text-gray-400 text-xs ml-1">(${d.road_time_min}ë¶„)</span>
                            </td>
                            <td class="px-4 py-2 text-center">${h2Badge}</td>
                            <td class="px-4 py-2 text-xs text-gray-500">${d.notes || '-'}</td>
                        </tr>
                    `;
                }).join('');
            document.getElementById('depotTable').innerHTML = depotRows;

            // Station Table (ì¶©ì „ì†Œ í˜„í™©) - í™•ì¥ëœ ì»¬ëŸ¼ í¬í•¨ (ì›”ë³„ ë°ì´í„°)
            const stationRows = [...currentStations]
                .sort((a, b) => {
                    const sort = getActiveSort('station');
                    const aVal = a[sort.field];
                    const bVal = b[sort.field];
                    const cmp = typeof aVal === 'string' ? aVal.localeCompare(bVal) : aVal - bVal;
                    return sort.direction === 'asc' ? cmp : -cmp;
                })
                .map((s, idx) => {
                    const share = ((s.total_kg / totalCharge) * 100).toFixed(1);
                    const dailyKg = (s.total_kg / 30).toFixed(1);
                    const dailyVisits = Math.round(s.count / 30);
                    const monthlyAmount = s.price_per_kg ? (s.total_kg * s.price_per_kg).toLocaleString() : '-';
                    const straightDist = getDistanceFromStation(s.lat, s.lng);
                    const inRadius = straightDist <= currentRadius;
                    const distClass = inRadius ? 'bg-green-200 text-green-800 font-bold' : 'bg-gray-100 text-gray-600';
                    return `
                        <tr class="border-b hover:bg-green-50 data-list-item ${inRadius ? 'bg-green-50' : ''}">
                            <td class="px-2 py-2 text-center text-gray-400 text-xs">${idx + 1}</td>
                            <td class="px-4 py-2 font-medium">${s.name.replace(' ìˆ˜ì†Œì¶©ì „ì†Œ', '')}</td>
                            <td class="px-3 py-2 text-right font-medium text-green-600">${s.total_kg.toLocaleString()} kg</td>
                            <td class="px-3 py-2 text-right text-gray-500">${dailyKg} kg</td>
                            <td class="px-3 py-2 text-right text-gray-500">${s.count}íšŒ</td>
                            <td class="px-3 py-2 text-right text-gray-500">${dailyVisits}ëŒ€</td>
                            <td class="px-3 py-2 text-right text-blue-600 font-medium">${s.price_per_kg?.toLocaleString() || '-'}ì›</td>
                            <td class="px-3 py-2 text-right text-amber-600 text-xs">${monthlyAmount}ì›</td>
                            <td class="px-3 py-2 text-right text-green-600 text-xs">${s.subsidy?.toLocaleString() || '-'}ì›</td>
                            <td class="px-3 py-2 text-right">
                                <span class="${distClass} px-2 py-0.5 rounded text-xs">${s.road_distance_km?.toFixed(1) || '-'} km</span>
                                <span class="text-gray-400 text-xs ml-1">(${s.road_time_min || '-'}ë¶„)</span>
                            </td>
                            <td class="px-3 py-2 text-right">
                                <div class="flex items-center justify-end gap-2">
                                    <div class="w-12 h-2 bg-gray-200 rounded-full overflow-hidden">
                                        <div class="h-full bg-green-500 rounded-full" style="width:${Math.min(share * 3, 100)}%"></div>
                                    </div>
                                    <span class="text-xs text-gray-600 w-10">${share}%</span>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            document.getElementById('stationTable').innerHTML = stationRows;

            // Update tab counts
            const tabTotalH2Buses = CUSTOMERS.reduce((sum, c) => sum + (c.h2_buses || 0), 0);
            document.getElementById('customerTabCount').textContent = CUSTOMERS.length + 'ê°œ (' + tabTotalH2Buses + 'ëŒ€)';
            document.getElementById('potentialTabCount').textContent = COUPANG_FC.length;
            document.getElementById('depotTabCount').textContent = BUS_DEPOTS.length;
            document.getElementById('stationTabCount').textContent = currentStations.length;
        }

        // ========== TAB SWITCHING ==========
        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active from all tabs
                    tabBtns.forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                    // Add active to clicked tab
                    this.classList.add('active');
                    const tabId = 'tab-' + this.dataset.tab;
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        // ========== EVENT HANDLERS ==========
        document.getElementById('radiusSlider').addEventListener('input', function(e) {
            const radius = parseInt(e.target.value);
            document.getElementById('radiusValue').textContent = `${radius}km`;
            updateSimulation(radius);
            initTables(); // ë°˜ê²½ ë³€ê²½ ì‹œ í…Œì´ë¸” ì¬ë Œë”ë§ (ìƒ‰ìƒ í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸)
        });

        // ë ˆì´ì–´ í† ê¸€ ì´ë²¤íŠ¸
        document.getElementById('stationToggle').addEventListener('change', function(e) {
            toggleStations(e.target.checked);
        });

        document.getElementById('customerToggle').addEventListener('change', function(e) {
            toggleCustomers(e.target.checked);
        });

        document.getElementById('fcToggle').addEventListener('change', function(e) {
            toggleCoupangFC(e.target.checked);
        });

        document.getElementById('depotToggle').addEventListener('change', function(e) {
            toggleDepots(e.target.checked);
        });

        // Daily target slider
        document.getElementById('dailyTargetSlider').addEventListener('input', function(e) {
            updateDailyTarget(parseInt(e.target.value));
        });

        // Daily target input
        document.getElementById('dailyTargetInput').addEventListener('change', function(e) {
            updateDailyTarget(parseInt(e.target.value) || 500);
        });

        // Handle keyboard input for daily target
        document.getElementById('dailyTargetInput').addEventListener('keydown', function(e) {
            if (e.key === 'ArrowUp') {
                e.preventDefault();
                updateDailyTarget(DAILY_TARGET + 100);
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                updateDailyTarget(DAILY_TARGET - 100);
            } else if (e.key === 'Enter') {
                updateDailyTarget(parseInt(e.target.value) || 500);
                e.target.blur();
            }
        });

        // ========== INIT ==========
        window.onload = function() {
            initMap();
            initCharts();
            initTables();
            initTabs();
            updateSimulation(20);
            // Initialize daily target display
            updateDailyTarget(1000);

            // Update summary card counts
            const totalH2Buses = CUSTOMERS.reduce((sum, c) => sum + (c.h2_buses || 0), 0);
            // ë„ë¡œê±°ë¦¬(kakao_km) 30km ì´ë‚´ ì¿ íŒ¡ FC ìˆ˜
            const fcCount30km = COUPANG_FC.filter(fc => fc.kakao_km <= 30).length;
            document.getElementById('activeCustomerCount').innerHTML = CUSTOMERS.length + 'ê°œ<span class="text-lg font-semibold text-cyan-200 ml-1">(' + totalH2Buses + 'ëŒ€)</span>';
            document.getElementById('potentialCount').innerHTML = fcCount30km + '<span class="text-sm ml-1">ê°œ</span>';
            document.getElementById('depotCount').innerHTML = BUS_DEPOTS.length + '<span class="text-sm ml-1">ê°œ</span>';
            const totalH2BusesDepot = BUS_DEPOTS.reduce((sum, d) => sum + d.h2_buses, 0);
            document.getElementById('h2BusCount').innerHTML = totalH2BusesDepot + '<span class="text-sm ml-1">ëŒ€</span>';

            // Update customer table header with total h2_buses count
            const totalH2BusesCustomer = CUSTOMERS.reduce((sum, c) => sum + (c.h2_buses || 0), 0);
            document.getElementById('totalH2BusesDisplay').innerHTML = totalH2BusesCustomer + '<span class="text-sm">ëŒ€</span>';

            // Initialize help modal tabs
            initHelpTabs();
        };

        // ========== HELP MODAL FUNCTIONS ==========
        function openHelpModal() {
            document.getElementById('helpModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // ESC key to close modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeHelpModal();
        });

        // Switch help tab
        function switchHelpTab(btn, tabId) {
            // Remove active from all tabs
            document.querySelectorAll('.help-tab').forEach(t => t.classList.remove('active'));
            // Add active to clicked tab
            btn.classList.add('active');

            // Hide all content
            document.querySelectorAll('.help-content').forEach(c => c.classList.add('hidden'));
            // Show selected content
            document.getElementById(`help-${tabId}`).classList.remove('hidden');
        }

        // Initialize help tabs (legacy - kept for compatibility)
        function initHelpTabs() {
            // Now using onclick handlers directly
        }
    </script>
</body>
</html>
